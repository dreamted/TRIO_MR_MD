###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V5.30.2.51295/W32 for ARM     02/Apr/2012  19:03:56 #
# Copyright 1999-2009 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  D:\Project\TRIO\3.F_W\TRIO_appl_src_20120401\lib_stm32\s #
#                    rc\stm32f10x_tim1_v0901.c                                #
#    Command line =  D:\Project\TRIO\3.F_W\TRIO_appl_src_20120401\lib_stm32\s #
#                    rc\stm32f10x_tim1_v0901.c -D NDEBUG -lcN                 #
#                    D:\Project\TRIO\3.F_W\TRIO_appl_src_20120401\sout\ -o    #
#                    D:\Project\TRIO\3.F_W\TRIO_appl_src_20120401\sout\       #
#                    --debug --endian=little --cpu=Cortex-M3 -e               #
#                    --warnings_are_errors --fpu=None --dlib_config           #
#                    "C:\Program Files\IAR Systems\Embedded Workbench         #
#                    5.4\arm\INC\DLib_Config_Normal.h" -I                     #
#                    D:\Project\TRIO\3.F_W\TRIO_appl_src_20120401\include\    #
#                    -I D:\Project\TRIO\3.F_W\TRIO_appl_src_20120401\lib_stm3 #
#                    2\inc\ -I D:\Project\TRIO\3.F_W\TRIO_appl_src_20120401\l #
#                    ib_stm32\src\ -I D:\Project\TRIO\3.F_W\TRIO_appl_src_201 #
#                    20401\uC-CPU\ -I D:\Project\TRIO\3.F_W\TRIO_appl_src_201 #
#                    20401\uC-LIB\ -I D:\Project\TRIO\3.F_W\TRIO_appl_src_201 #
#                    20401\uCOS-II\Ports\ -I D:\Project\TRIO\3.F_W\TRIO_appl_ #
#                    src_20120401\uCOS-II\Source\ -I                          #
#                    D:\Project\TRIO\3.F_W\TRIO_appl_src_20120401\uC-Probe\   #
#                    -I "C:\Program Files\IAR Systems\Embedded Workbench      #
#                    5.4\arm\INC\" -Oh                                        #
#    List file    =  D:\Project\TRIO\3.F_W\TRIO_appl_src_20120401\sout\stm32f #
#                    10x_tim1_v0901.lst                                       #
#    Object file  =  D:\Project\TRIO\3.F_W\TRIO_appl_src_20120401\sout\stm32f #
#                    10x_tim1_v0901.o                                         #
#                                                                             #
#                                                                             #
###############################################################################

D:\Project\TRIO\3.F_W\TRIO_appl_src_20120401\lib_stm32\src\stm32f10x_tim1_v0901.c
      1          /******************** (C) COPYRIGHT 2007 STMicroelectronics ********************
      2          * File Name          : stm32f10x_tim1.c
      3          * Author             : MCD Application Team
      4          * Date First Issued  : 09/29/2006
      5          * Description        : This file provides all the TIM1 software functions.
      6          ********************************************************************************
      7          * History:
      8          * 05/21/2007: V0.3
      9          * 04/02/2007: V0.2
     10          * 02/05/2007: V0.1
     11          * 09/29/2006: V0.01
     12          ********************************************************************************
     13          * THE PRESENT SOFTWARE WHICH IS FOR GUIDANCE ONLY AIMS AT PROVIDING CUSTOMERS
     14          * WITH CODING INFORMATION REGARDING THEIR PRODUCTS IN ORDER FOR THEM TO SAVE TIME.
     15          * AS A RESULT, STMICROELECTRONICS SHALL NOT BE HELD LIABLE FOR ANY DIRECT,
     16          * INDIRECT OR CONSEQUENTIAL DAMAGES WITH RESPECT TO ANY CLAIMS ARISING FROM THE
     17          * CONTENT OF SUCH SOFTWARE AND/OR THE USE MADE BY CUSTOMERS OF THE CODING
     18          * INFORMATION CONTAINED HEREIN IN CONNECTION WITH THEIR PRODUCTS.
     19          *******************************************************************************/
     20          
     21          /* Includes ------------------------------------------------------------------*/
     22          #include "stm32f10x_conf.h"
     23          
     24          /* Private typedef -----------------------------------------------------------*/
     25          /* Private define ------------------------------------------------------------*/
     26          
     27          /* ------------ TIM1 registers bit address in the alias region ----------- */
     28          #define TIM1_OFFSET    (TIM1_BASE - PERIPH_BASE)
     29          // (PERIPH_BASE + 0x10000) + 0x2C00 - PERIPH_BASE
     30          /* --- TIM1 CR1 Register ---*/
     31          /* Alias word address of CEN bit */
     32          #define CR1_OFFSET        (TIM1_OFFSET + 0x00)
     33          #define CEN_BitNumber     0x00
     34          #define CR1_CEN_BB        (PERIPH_BB_BASE + (CR1_OFFSET * 32) + (CEN_BitNumber * 4))
     35          
     36          /* Alias word address of UDIS bit */
     37          #define UDIS_BitNumber    0x01
     38          #define CR1_UDIS_BB       (PERIPH_BB_BASE + (CR1_OFFSET * 32) + (UDIS_BitNumber * 4))
     39          
     40          /* Alias word address of URS bit */
     41          #define URS_BitNumber     0x02
     42          #define CR1_URS_BB        (PERIPH_BB_BASE + (CR1_OFFSET * 32) + (URS_BitNumber * 4))
     43          
     44          /* Alias word address of OPM bit */
     45          #define OPM_BitNumber     0x03
     46          #define CR1_OPM_BB        (PERIPH_BB_BASE + (CR1_OFFSET * 32) + (OPM_BitNumber * 4))
     47          
     48          /* Alias word address of ARPE bit */
     49          #define ARPE_BitNumber    0x07
     50          #define CR1_ARPE_BB       (PERIPH_BB_BASE + (CR1_OFFSET * 32) + (ARPE_BitNumber * 4))
     51          
     52          /* --- TIM1 CR2 Register --- */
     53          /* Alias word address of CCPC bit */
     54          #define CR2_OFFSET        (TIM1_OFFSET + 0x04)
     55          #define CCPC_BitNumber    0x00
     56          #define CR2_CCPC_BB       (PERIPH_BB_BASE + (CR2_OFFSET * 32) + (CCPC_BitNumber * 4))
     57          
     58          /* Alias word address of CCUS bit */
     59          #define CCUS_BitNumber    0x02
     60          #define CR2_CCUS_BB       (PERIPH_BB_BASE + (CR2_OFFSET * 32) + (CCUS_BitNumber * 4))
     61          
     62          /* Alias word address of CCDS bit */
     63          #define CCDS_BitNumber    0x03
     64          #define CR2_CCDS_BB       (PERIPH_BB_BASE + (CR2_OFFSET * 32) + (CCDS_BitNumber * 4))
     65          
     66          /* Alias word address of TI1S bit */
     67          #define TI1S_BitNumber    0x07
     68          #define CR2_TI1S_BB       (PERIPH_BB_BASE + (CR2_OFFSET * 32) + (TI1S_BitNumber * 4))
     69          
     70          /* Alias word address of OIS1 bit */
     71          #define OIS1_BitNumber    0x08
     72          #define CR2_OIS1_BB       (PERIPH_BB_BASE + (CR2_OFFSET * 32) + (OIS1_BitNumber * 4))
     73          
     74          /* Alias word address of OIS1N bit */
     75          #define OIS1N_BitNumber   0x09
     76          #define CR2_OIS1N_BB      (PERIPH_BB_BASE + (CR2_OFFSET * 32) + (OIS1N_BitNumber * 4))
     77          
     78          /* Alias word address of OIS2 bit */
     79          #define OIS2_BitNumber    0x0A
     80          #define CR2_OIS2_BB      (PERIPH_BB_BASE + (CR2_OFFSET * 32) + (OIS2_BitNumber * 4))
     81          
     82          /* Alias word address of OIS2N bit */
     83          #define OIS2N_BitNumber   0x0B
     84          #define CR2_OIS2N_BB      (PERIPH_BB_BASE + (CR2_OFFSET * 32) + (OIS2N_BitNumber * 4))
     85          
     86          /* Alias word address of OIS3 bit */
     87          #define OIS3_BitNumber    0x0C
     88          #define CR2_OIS3_BB       (PERIPH_BB_BASE + (CR2_OFFSET * 32) + (OIS3_BitNumber * 4))
     89          
     90          /* Alias word address of OIS3N bit */
     91          #define OIS3N_BitNumber   0x0D
     92          #define CR2_OIS3N_BB      (PERIPH_BB_BASE + (CR2_OFFSET * 32) + (OIS3N_BitNumber * 4))
     93          
     94          /* Alias word address of OIS4 bit */
     95          #define OIS4_BitNumber    0x0E
     96          #define CR2_OIS4_BB       (PERIPH_BB_BASE + (CR2_OFFSET * 32) + (OIS4_BitNumber * 4))
     97          
     98          /* --- TIM1 SMCR Register --- */
     99          /* Alias word address of MSM bit */
    100          #define SMCR_OFFSET       (TIM1_OFFSET + 0x08)
    101          #define MSM_BitNumber     0x07
    102          #define SMCR_MSM_BB       (PERIPH_BB_BASE + (SMCR_OFFSET * 32) + (MSM_BitNumber * 4))
    103          
    104          /* Alias word address of ECE bit */
    105          #define ECE_BitNumber     0x0E
    106          #define SMCR_ECE_BB       (PERIPH_BB_BASE + (SMCR_OFFSET * 32) + (ECE_BitNumber * 4))
    107          
    108          /* --- TIM1 EGR Register --- */
    109          /* Alias word address of UG bit */
    110          #define EGR_OFFSET        (TIM1_OFFSET + 0x14)
    111          #define UG_BitNumber      0x00
    112          #define EGR_UG_BB         (PERIPH_BB_BASE + (EGR_OFFSET * 32) + (UG_BitNumber * 4))
    113          
    114          /* --- TIM1 CCER Register --- */
    115          /* Alias word address of CC1E bit */
    116          #define CCER_OFFSET       (TIM1_OFFSET + 0x20)
    117          #define CC1E_BitNumber    0x00
    118          #define CCER_CC1E_BB      (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC1E_BitNumber * 4))
    119          
    120          // (PERIPH_BASE + 0x10000) + 0x2C00 - PERIPH_BASE
    121          
    122          
    123          /* Alias word address of CC1P bit */
    124          #define CC1P_BitNumber    0x01
    125          #define CCER_CC1P_BB      (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC1P_BitNumber * 4))
    126          
    127          /* Alias word address of CC1NE bit */
    128          #define CC1NE_BitNumber   0x02
    129          #define CCER_CC1NE_BB     (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC1NE_BitNumber * 4))
    130          
    131          /* Alias word address of CC1NP bit */
    132          #define CC1NP_BitNumber   0x03
    133          #define CCER_CC1NP_BB     (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC1NP_BitNumber * 4))
    134          
    135          /* Alias word address of CC2E bit */
    136          #define CC2E_BitNumber    0x04
    137          #define CCER_CC2E_BB      (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC2E_BitNumber * 4))
    138          
    139          /* Alias word address of CC2P bit */
    140          #define CC2P_BitNumber    0x05
    141          #define CCER_CC2P_BB      (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC2P_BitNumber * 4))
    142          
    143          /* Alias word address of CC2NE bit */
    144          #define CC2NE_BitNumber   0x06
    145          #define CCER_CC2NE_BB     (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC2NE_BitNumber * 4))
    146          
    147          /* Alias word address of CC2NP bit */
    148          #define CC2NP_BitNumber   0x07
    149          #define CCER_CC2NP_BB     (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC2NP_BitNumber * 4))
    150          
    151          /* Alias word address of CC3E bit */
    152          #define CC3E_BitNumber    0x08
    153          #define CCER_CC3E_BB      (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC3E_BitNumber * 4))
    154          
    155          /* Alias word address of CC3P bit */
    156          #define CC3P_BitNumber    0x09
    157          #define CCER_CC3P_BB      (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC3P_BitNumber * 4))
    158          
    159          /* Alias word address of CC3NE bit */
    160          #define CC3NE_BitNumber   0x0A
    161          #define CCER_CC3NE_BB     (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC3NE_BitNumber * 4))
    162          
    163          /* Alias word address of CC3NP bit */
    164          #define CC3NP_BitNumber   0x0B
    165          #define CCER_CC3NP_BB     (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC3NP_BitNumber * 4))
    166          
    167          /* Alias word address of CC4E bit */
    168          #define CC4E_BitNumber    0x0C
    169          #define CCER_CC4E_BB      (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC4E_BitNumber * 4))
    170          
    171          /* Alias word address of CC4P bit */
    172          #define CC4P_BitNumber    0x0D
    173          #define CCER_CC4P_BB      (PERIPH_BB_BASE + (CCER_OFFSET * 32) + (CC4P_BitNumber * 4))
    174          
    175          /* --- TIM1 BDTR Register --- */
    176          /* Alias word address of MOE bit */
    177          #define BDTR_OFFSET       (TIM1_OFFSET + 0x44)
    178          #define MOE_BitNumber     0x0F
    179          #define BDTR_MOE_BB       (PERIPH_BB_BASE + (BDTR_OFFSET * 32) + (MOE_BitNumber * 4))
    180          
    181          /* --- TIM1 CCMR1 Register --- */
    182          /* Alias word address of OC1FE bit */
    183          #define CCMR1_OFFSET      (TIM1_OFFSET + 0x18)
    184          #define OC1FE_BitNumber   0x02
    185          #define CCMR1_OC1FE_BB    (PERIPH_BB_BASE + (CCMR1_OFFSET * 32) + (OC1FE_BitNumber * 4))
    186          
    187          /* Alias word address of OC1PE bit */
    188          #define OC1PE_BitNumber   0x03
    189          #define CCMR1_OC1PE_BB    (PERIPH_BB_BASE + (CCMR1_OFFSET * 32) + (OC1PE_BitNumber * 4))
    190          
    191          /* Alias word address of OC1CE bit */
    192          #define OC1CE_BitNumber   0x07
    193          #define CCMR1_OC1CE_BB    (PERIPH_BB_BASE + (CCMR1_OFFSET * 32) + (OC1CE_BitNumber * 4))
    194          
    195          /* Alias word address of OC2FE bit */
    196          #define OC2FE_BitNumber   0x0A
    197          #define CCMR1_OC2FE_BB    (PERIPH_BB_BASE + (CCMR1_OFFSET * 32) + (OC2FE_BitNumber * 4))
    198          
    199          /* Alias word address of OC2PE bit */
    200          #define OC2PE_BitNumber   0x0B
    201          #define CCMR1_OC2PE_BB    (PERIPH_BB_BASE + (CCMR1_OFFSET * 32) + (OC2PE_BitNumber * 4))
    202          
    203          /* Alias word address of OC2CE bit */
    204          #define OC2CE_BitNumber   0x0F
    205          #define CCMR1_OC2CE_BB    (PERIPH_BB_BASE + (CCMR1_OFFSET * 32) + (OC2CE_BitNumber * 4))
    206          
    207          /* --- TIM1 CCMR2 Register ---- */
    208          /* Alias word address of OC3FE bit */
    209          #define CCMR2_OFFSET      (TIM1_OFFSET + 0x1C)
    210          #define OC3FE_BitNumber   0x02
    211          #define CCMR2_OC3FE_BB    (PERIPH_BB_BASE + (CCMR2_OFFSET * 32) + (OC3FE_BitNumber * 4))
    212          
    213          /* Alias word address of OC3PE bit */
    214          #define OC3PE_BitNumber   0x03
    215          #define CCMR2_OC3PE_BB    (PERIPH_BB_BASE + (CCMR2_OFFSET * 32) + (OC3PE_BitNumber * 4))
    216          
    217          /* Alias word address of OC3CE bit */
    218          #define OC3CE_BitNumber   0x07
    219          #define CCMR2_OC3CE_BB    (PERIPH_BB_BASE + (CCMR2_OFFSET * 32) + (OC3CE_BitNumber * 4))
    220          
    221          /* Alias word address of OC4FE bit */
    222          #define OC4FE_BitNumber   0x0A
    223          #define CCMR2_OC4FE_BB    (PERIPH_BB_BASE + (CCMR2_OFFSET * 32) + (OC4FE_BitNumber * 4))
    224          
    225          /* Alias word address of OC4PE bit */
    226          #define OC4PE_BitNumber   0x0B
    227          #define CCMR2_OC4PE_BB    (PERIPH_BB_BASE + (CCMR2_OFFSET * 32) + (OC4PE_BitNumber * 4))
    228          
    229          /* Alias word address of OC4CE bit */
    230          #define OC4CE_BitNumber   0x0F
    231          #define CCMR2_OC4CE_BB    (PERIPH_BB_BASE + (CCMR2_OFFSET * 32) + (OC4CE_BitNumber * 4))
    232          
    233          /* --------------------- TIM1 registers bit mask ------------------------- */
    234          /* TIM1 CR1 Mask */
    235          #define CR1_CounterMode_Mask                ((u16)0x039F)
    236          #define CR1_CKD_Mask                        ((u16)0x00FF)
    237          
    238          /* TIM1 CR2 Mask */
    239          #define CR2_MMS_Mask                        ((u16)0x0080)
    240          
    241          /* TIM1 SMCR Mask */
    242          #define SMCR_SMS_Mask                       ((u16)0xFFF0)
    243          #define SMCR_ETR_Mask                       ((u16)0x40F7)
    244          #define SMCR_TS_Mask                        ((u16)0xFF87)
    245          #define SMCR_ECE_Set                        ((u16)0x0001)
    246          
    247          /* TIM1 CCMRx Mask */
    248          #define CCMR_CC13S_Mask                     ((u16)0xFFFC)
    249          #define CCMR_CC24S_Mask                     ((u16)0xFCFF)
    250          #define CCMR_TI13Direct_Set                 ((u16)0x0001)
    251          #define CCMR_TI24Direct_Set                 ((u16)0x0100)
    252          #define CCMR_OCM13_Mask                     ((u16)0x7F0F)
    253          #define CCMR_OCM24_Mask                     ((u16)0x0F7F)
    254          #define CCMR_IC13PSC_Mask                   ((u16)0xFFF3)
    255          #define CCMR_IC24PSC_Mask                   ((u16)0xF3FF)
    256          #define CCMR_IC13F_Mask                     ((u16)0xFF0F)
    257          #define CCMR_IC24F_Mask                     ((u16)0x0FFF)
    258          #define OC13Mode_Mask		                ((u16)0xFF00)
    259          #define OC24Mode_Mask		                ((u16)0x00FF)
    260          
    261          /* TIM1 CCER Set/Reset Bit */
    262          #define CCER_CCE_Set                        ((u16)0x0001)
    263          #define CCER_CCE_Reset                      ((u16)0x0000)
    264          
    265          /* TIM1 DMA Mask */
    266          #define DCR_DMA_Mask                        ((u16)0x0000)
    267          
    268          /* TIM1 private Masks */
    269          #define TIM1_Period_Reset_Mask               ((u16)0xFFFF)
    270          #define TIM1_Prescaler_Reset_Mask            ((u16)0x0000)
    271          #define TIM1_RepetitionCounter_Reset_Mask    ((u16)0x0000)
    272          #define TIM1_Pulse_Reset_Mask                ((u16)0x0000)
    273          #define TIM1_ICFilter_Mask                   ((u8)0x00)
    274          #define TIM1_DeadTime_Reset_Mask             ((u16)0x0000)
    275          
    276          /* Private macro -------------------------------------------------------------*/
    277          /* Private variables ---------------------------------------------------------*/
    278          /* Private function prototypes -----------------------------------------------*/
    279          static void TI1_Config(u16 TIM1_ICPolarity, u16 TIM1_ICSelection,
    280                                 u8 TIM1_ICFilter);
    281          static void TI2_Config(u16 TIM1_ICPolarity, u16 TIM1_ICSelection,
    282                                 u8 TIM1_ICFilter);
    283          static void TI3_Config(u16 TIM1_ICPolarity, u16 TIM1_ICSelection,
    284                                 u8 TIM1_ICFilter);
    285          static void TI4_Config(u16 TIM1_ICPolarity, u16 TIM1_ICSelection,
    286                                 u8 TIM1_ICFilter);
    287          
    288          void TIM1_Init(int freq)
    289          {
    290          	int period = (SYSCLK/freq - 1);
    291          
    292          	if(period & 0xFFFF0000) period = 0xFFFF;
    293          	TIM1->ARR = period;
    294          	TIM1->PSC = 0;		// default: 0
    295          	TIM1->RCR = 0;		// default: 0
    296          						// default: clock divistion = 0, up counter
    297          	// TIM1 counter enable
    298          	// set or Reset the CEN Bit
    299          	TIM1->CR1.Bit.CEN = ENABLE;
    300          	TIM1->BDTR.Bit.MOE = SET;		// main output enable
    301          
    302          	// TIM1 Main Output Enable
    303          	//TIM1_CtrlPWMOutputs(ENABLE);
    304          	//TIM1_CtrlPWMOutputs(DISABLE);
    305          }
    306          
    307          void TIM1_OC1Init(int mode, int duty)
    308          {
    309            /* Check the parameters */
    310          //  assert(IS_TIM1_OC_MODE(TIM1_OCInitStruct->TIM1_OCMode));
    311          //  assert(IS_TIM1_OUTPUT_STATE(TIM1_OCInitStruct->TIM1_OutputState));
    312          //  assert(IS_TIM1_OUTPUTN_STATE(TIM1_OCInitStruct->TIM1_OutputNState));
    313          //  assert(IS_TIM1_OC_POLARITY(TIM1_OCInitStruct->TIM1_OCPolarity));
    314          //  assert(IS_TIM1_OCN_POLARITY(TIM1_OCInitStruct->TIM1_OCNPolarity));
    315          //  assert(IS_TIM1_OCIDLE_STATE(TIM1_OCInitStruct->TIM1_OCIdleState));
    316          //  assert(IS_TIM1_OCNIDLE_STATE(TIM1_OCInitStruct->TIM1_OCNIdleState)); 
    317          
    318            /* Channel 1, 2,3 and 4 Configuration in PWM mode */
    319          //  TIM1_OCInitStructure.TIM1_OCMode = TIM1_OCMode_PWM2; 
    320          //  TIM1_OCInitStructure.TIM1_OutputState = TIM1_OutputState_Enable; 
    321          //  TIM1_OCInitStructure.TIM1_OutputNState = TIM1_OutputNState_Enable;                  
    322          //  TIM1_OCInitStructure.TIM1_Pulse = CCR1_Val; 
    323          //  TIM1_OCInitStructure.TIM1_OCPolarity = TIM1_OCPolarity_Low; 
    324          //  TIM1_OCInitStructure.TIM1_OCNPolarity = TIM1_OCNPolarity_High;         
    325          //  TIM1_OCInitStructure.TIM1_OCIdleState = TIM1_OCIdleState_Set;
    326          //  TIM1_OCInitStructure.TIM1_OCNIdleState = TIM1_OCIdleState_Reset;   
    327          
    328            	// Disable the Channel 1: Reset the CCE Bit
    329          	//  *(vu32 *) CCER_CC1E_BB = CCER_CCE_Reset;
    330            	TIM1->BDTR.Bit.MOE = RESET; 	  // main output enable
    331          	TIM1->CCER.Bit.CC1E = DISABLE;
    332          
    333          	// Reset the Output Compare Bits
    334          	// tmpccmr &= OC13Mode_Mask;
    335          
    336          	// Set the Ouput Compare Mode
    337          	// tmpccmr |= TIM1_OCInitStruct->TIM1_OCMode;
    338          	TIM1->CCMR.Bit_OC.OC1M = mode;
    339          	// Set the Output State
    340          	TIM1->CCER.Bit.CC1E = ENABLE;
    341          
    342          	// Set the Output N State
    343          	//  *(vu32 *) CCER_CC1NE_BB = TIM1_OCInitStruct->TIM1_OutputNState;
    344          
    345          	// Set the Output Polarity
    346          	//  *(vu32 *) CCER_CC1P_BB = TIM1_OCInitStruct->TIM1_OCPolarity;
    347          
    348          	// Set the Output N Polarity
    349          	// *(vu32 *) CCER_CC1NP_BB = TIM1_OCInitStruct->TIM1_OCNPolarity;
    350          
    351          	// Set the Output Idle state
    352          	TIM1->CR2.Bit.OIS1 = SET;
    353          	//  *(vu32 *) CR2_OIS1_BB = TIM1_OCInitStruct->TIM1_OCIdleState;
    354          
    355          	// Set the Output N Idle state
    356          	TIM1->CR2.Bit.OIS1N = RESET;
    357          	//  *(vu32 *) CR2_OIS1N_BB = TIM1_OCInitStruct->TIM1_OCNIdleState;
    358          
    359          	// Set the Pulse value
    360          	if(mode == __TIM1_PWM2) TIM1->CCR1 =  ((TIM1->ARR)*duty)/100;
    361            	TIM1->BDTR.Bit.MOE = SET; 	  // main output enable
    362          
    363          }
    364          
    365          void TIM1_OC1PWMOutputs(int tEn)
    366          {
    367          	TIM1->CCER.Bit.CC1E = tEn;
    368          }
    369          
    370          void TIM1_OC4PWMOutputs(int tEn)
    371          {
    372          	TIM1->CCER.Bit.CC4E = tEn;
    373          }
    374          
    375          /*******************************************************************************
    376          * Function Name  : TIM1_OC4Init
    377          * Description    : Initializes the TIM1 Channel4 according to the specified
    378          *                  parameters in the TIM1_OCInitStruct.
    379          * Input          : - TIM1_OCInitStruct: pointer to a TIM1_OCInitTypeDef structure that
    380          *                    contains the configuration information for the TIM1 peripheral.
    381          * Output         : None
    382          * Return         : None
    383          *******************************************************************************/
    384          void TIM1_OC4Init(int mode, int duty)
    385          {
    386              //u32 tmpccmr = 0;
    387            
    388              /* Check the parameters */
    389              //assert(IS_TIM1_OC_MODE(TIM1_OCInitStruct->TIM1_OCMode));
    390              //assert(IS_TIM1_OUTPUT_STATE(TIM1_OCInitStruct->TIM1_OutputState));
    391              //assert(IS_TIM1_OC_POLARITY(TIM1_OCInitStruct->TIM1_OCPolarity));
    392              //assert(IS_TIM1_OCIDLE_STATE(TIM1_OCInitStruct->TIM1_OCIdleState));
    393            
    394              //tmpccmr = TIM1->CCMR2.Data;
    395            
    396              // Disable the Channel 4: Reset the CCE Bit
    397              //*(vu32 *) CCER_CC4E_BB = CCER_CCE_Reset;
    398              TIM1->BDTR.Bit.MOE = RESET;		// main output enable
    399              TIM1->CCER.Bit.CC4E = DISABLE;
    400            
    401              // Reset the Output Compare Bits
    402              // tmpccmr &= OC24Mode_Mask;
    403            
    404              /* Set the Ouput Compare Mode */
    405              //tmpccmr |= (u32)TIM1_OCInitStruct->TIM1_OCMode << 8;
    406              //TIM1->CCMR2.Data = (u16)tmpccmr;
    407              TIM1->CCMR.Bit_OC.OC4M = mode;
    408              TIM1->CCER.Bit.CC4E = ENABLE;
    409            
    410              /* Set the Output State */
    411              //*(vu32 *) CCER_CC4E_BB = TIM1_OCInitStruct->TIM1_OutputState;
    412            
    413              /* Set the Output Polarity */
    414             // *(vu32 *) CCER_CC4P_BB = TIM1_OCInitStruct->TIM1_OCPolarity;
    415            
    416              /* Set the Output Idle state */
    417              //*(vu32 *) CR2_OIS4_BB = TIM1_OCInitStruct->TIM1_OCIdleState;
    418          	TIM1->CR2.Bit.OIS1 = SET;
    419          	
    420              /* Set the Pulse value */
    421              // Set the Pulse value
    422              if(mode == __TIM1_PWM2) TIM1->CCR4 =	((TIM1->ARR)*duty)/100;
    423              TIM1->BDTR.Bit.MOE = SET;		// main output enable
    424          }
    425          
    426          
    427          /*******************************************************************************
    428          * Function Name  : TIM1_TimeBaseInit
    429          * Description    : Initializes the TIM1 Time Base Unit according to the specified
    430          *                  parameters in the TIM1_TimeBaseInitStruct.
    431          * Input          : - TIM1_TimeBaseInitStruct: pointer to a TIM1_TimeBaseInitTypeDef
    432          *                    structure that contains the configuration information for
    433          *                    the specified TIM1 peripheral.
    434          * Output         : None
    435          * Return         : None
    436          *******************************************************************************/
    437          void TIM1_TimeBaseInit(TIM1_TimeBaseInitTypeDef* TIM1_TimeBaseInitStruct)
    438          {
    439           /* Check the parameters */
    440            assert(IS_TIM1_COUNTER_MODE(TIM1_TimeBaseInitStruct->TIM1_CounterMode));
    441          
    442            /* Set the Autoreload value */
    443            TIM1->ARR = TIM1_TimeBaseInitStruct->TIM1_Period ;
    444          
    445            /* Set the Prescaler value */
    446            TIM1->PSC = TIM1_TimeBaseInitStruct->TIM1_Prescaler;
    447          
    448            /* Select the Counter Mode and set the clock division */
    449            TIM1->CR1.Data &= CR1_CKD_Mask & CR1_CounterMode_Mask;
    450            TIM1->CR1.Data |= (u32)TIM1_TimeBaseInitStruct->TIM1_ClockDivision |
    451                         TIM1_TimeBaseInitStruct->TIM1_CounterMode;
    452          
    453            /* Set the Repetition Counter value */
    454            TIM1->RCR = TIM1_TimeBaseInitStruct->TIM1_RepetitionCounter;
    455          }
    456          
    457          /*******************************************************************************
    458          * Function Name  : TIM1_OC1Init
    459          * Description    : Initializes the TIM1 Channel1 according to the specified
    460          *                  parameters in the TIM1_OCInitStruct.
    461          * Input          : - TIM1_OCInitStruct: pointer to a TIM1_OCInitTypeDef structure that
    462          *                    contains the configuration information for the TIM1 peripheral.
    463          * Output         : None
    464          * Return         : None
    465          *******************************************************************************/
    466          extern unsigned long int USART1Printf( const char *format, ...);
    467          
    468          /*******************************************************************************
    469          * Function Name  : TIM1_OC2Init
    470          * Description    : Initializes the TIM1 Channel2 according to the specified
    471          *                  parameters in the TIM1_OCInitStruct.
    472          * Input          : - TIM1_OCInitStruct: pointer to a TIM1_OCInitTypeDef structure that
    473          *                    contains the configuration information for the TIM1 peripheral.
    474          * Output         : None
    475          * Return         : None
    476          *******************************************************************************/
    477          void TIM1_OC2Init(TIM1_OCInitTypeDef* TIM1_OCInitStruct)
    478          {
    479            u32 tmpccmr = 0;
    480          
    481            /* Check the parameters */
    482            assert(IS_TIM1_OC_MODE(TIM1_OCInitStruct->TIM1_OCMode));
    483            assert(IS_TIM1_OUTPUT_STATE(TIM1_OCInitStruct->TIM1_OutputState));
    484            assert(IS_TIM1_OUTPUTN_STATE(TIM1_OCInitStruct->TIM1_OutputNState));
    485            assert(IS_TIM1_OC_POLARITY(TIM1_OCInitStruct->TIM1_OCPolarity));
    486            assert(IS_TIM1_OCN_POLARITY(TIM1_OCInitStruct->TIM1_OCNPolarity));
    487            assert(IS_TIM1_OCIDLE_STATE(TIM1_OCInitStruct->TIM1_OCIdleState));
    488            assert(IS_TIM1_OCNIDLE_STATE(TIM1_OCInitStruct->TIM1_OCNIdleState));
    489          
    490            tmpccmr = TIM1->CCMR.Data[0];
    491          
    492            /* Disable the Channel 2: Reset the CCE Bit */
    493            *(vu32 *) CCER_CC2E_BB = CCER_CCE_Reset;
    494          
    495            /* Reset the Output Compare Bits */
    496             tmpccmr &= OC24Mode_Mask;
    497          
    498            /* Set the Ouput Compare Mode */
    499            tmpccmr |= (u32)TIM1_OCInitStruct->TIM1_OCMode << 8;
    500          
    501            TIM1->CCMR.Data[0] = (u16)tmpccmr;
    502          
    503            /* Set the Output State */
    504            *(vu32 *) CCER_CC2E_BB = TIM1_OCInitStruct->TIM1_OutputState;
    505          
    506            /* Set the Output N State */
    507            *(vu32 *) CCER_CC2NE_BB = TIM1_OCInitStruct->TIM1_OutputNState;
    508          
    509            /* Set the Output Polarity */
    510            *(vu32 *) CCER_CC2P_BB = TIM1_OCInitStruct->TIM1_OCPolarity;
    511          
    512            /* Set the Output N Polarity */
    513            *(vu32 *) CCER_CC2NP_BB = TIM1_OCInitStruct->TIM1_OCNPolarity;
    514          
    515            /* Set the Output Idle state */
    516            *(vu32 *) CR2_OIS2_BB = TIM1_OCInitStruct->TIM1_OCIdleState;
    517          
    518            /* Set the Output N Idle state */
    519            *(vu32 *) CR2_OIS2N_BB = TIM1_OCInitStruct->TIM1_OCNIdleState;
    520          
    521            /* Set the Pulse value */
    522            TIM1->CCR2 = TIM1_OCInitStruct->TIM1_Pulse;
    523          }
    524          
    525          /*******************************************************************************
    526          * Function Name  : TIM1_OC3Init
    527          * Description    : Initializes the TIM1 Channel3 according to the specified
    528          *                  parameters in the TIM1_OCInitStruct.
    529          * Input          : - TIM1_OCInitStruct: pointer to a TIM1_OCInitTypeDef structure that
    530          *                    contains the configuration information for the TIM1 peripheral.
    531          * Output         : None
    532          * Return         : None
    533          *******************************************************************************/
    534          void TIM1_OC3Init(TIM1_OCInitTypeDef* TIM1_OCInitStruct)
    535          {
    536            u16 tmpccmr = 0;
    537          
    538            /* Check the parameters */
    539            assert(IS_TIM1_OC_MODE(TIM1_OCInitStruct->TIM1_OCMode));
    540            assert(IS_TIM1_OUTPUT_STATE(TIM1_OCInitStruct->TIM1_OutputState));
    541            assert(IS_TIM1_OUTPUTN_STATE(TIM1_OCInitStruct->TIM1_OutputNState));
    542            assert(IS_TIM1_OC_POLARITY(TIM1_OCInitStruct->TIM1_OCPolarity));
    543            assert(IS_TIM1_OCN_POLARITY(TIM1_OCInitStruct->TIM1_OCNPolarity));
    544            assert(IS_TIM1_OCIDLE_STATE(TIM1_OCInitStruct->TIM1_OCIdleState));
    545            assert(IS_TIM1_OCNIDLE_STATE(TIM1_OCInitStruct->TIM1_OCNIdleState));
    546          
    547            tmpccmr = TIM1->CCMR.Data[1];
    548          
    549            /* Disable the Channel 3: Reset the CCE Bit */
    550            *(vu32 *) CCER_CC3E_BB = CCER_CCE_Reset;
    551          
    552            /* Reset the Output Compare Bits */
    553             tmpccmr &= OC13Mode_Mask;
    554          
    555            /* Set the Ouput Compare Mode */
    556            tmpccmr |= TIM1_OCInitStruct->TIM1_OCMode;
    557          
    558            TIM1->CCMR.Data[1] = tmpccmr;
    559          
    560            /* Set the Output State */
    561            *(vu32 *) CCER_CC3E_BB = TIM1_OCInitStruct->TIM1_OutputState;
    562          
    563            /* Set the Output N State */
    564            *(vu32 *) CCER_CC3NE_BB = TIM1_OCInitStruct->TIM1_OutputNState;
    565          
    566            /* Set the Output Polarity */
    567            *(vu32 *) CCER_CC3P_BB = TIM1_OCInitStruct->TIM1_OCPolarity;
    568          
    569            /* Set the Output N Polarity */
    570            *(vu32 *) CCER_CC3NP_BB = TIM1_OCInitStruct->TIM1_OCNPolarity;
    571          
    572            /* Set the Output Idle state */
    573            *(vu32 *) CR2_OIS3_BB = TIM1_OCInitStruct->TIM1_OCIdleState;
    574          
    575            /* Set the Output N Idle state */
    576            *(vu32 *) CR2_OIS3N_BB = TIM1_OCInitStruct->TIM1_OCNIdleState;
    577          
    578            /* Set the Pulse value */
    579            TIM1->CCR3 = TIM1_OCInitStruct->TIM1_Pulse;
    580          }
    581          
    582          /*******************************************************************************
    583          * Function Name  : TIM1_BDTRConfig
    584          * Description    : Configures the: Break feature, dead time, Lock level, the OSSI,
    585          *                  the OSSR State and the AOE(automatic output enable).
    586          * Input          : - TIM1_BDTRInitStruct: pointer to a TIM1_BDTRInitTypeDef
    587          *                    structure that contains the BDTR Register configuration
    588          *                    information for the TIM1 peripheral.
    589          * Output         : None
    590          * Return         : None
    591          *******************************************************************************/
    592          void TIM1_BDTRConfig(TIM1_BDTRInitTypeDef *TIM1_BDTRInitStruct)
    593          {
    594            u16 tmpbdtr = 0;
    595          
    596            /* Check the parameters */
    597            assert(IS_TIM1_OSSR_STATE(TIM1_BDTRInitStruct->TIM1_OSSRState));
    598            assert(IS_TIM1_OSSI_STATE(TIM1_BDTRInitStruct->TIM1_OSSIState));
    599            assert(IS_TIM1_LOCK_LEVEL(TIM1_BDTRInitStruct->TIM1_LOCKLevel));
    600            assert(IS_TIM1_BREAK_STATE(TIM1_BDTRInitStruct->TIM1_Break));
    601            assert(IS_TIM1_BREAK_POLARITY(TIM1_BDTRInitStruct->TIM1_BreakPolarity));
    602            assert(IS_TIM1_AUTOMATIC_OUTPUT_STATE(TIM1_BDTRInitStruct->TIM1_AutomaticOutput));
    603          
    604            tmpbdtr = TIM1->BDTR.Data;
    605          
    606            /* Set the Lock level, the Break enable Bit and the Ploarity, the OSSR State,
    607               the OSSI State, the dead time value and the Automatic Output Enable Bit */
    608          
    609            tmpbdtr = (u32)TIM1_BDTRInitStruct->TIM1_OSSRState | TIM1_BDTRInitStruct->TIM1_OSSIState |
    610                       TIM1_BDTRInitStruct->TIM1_LOCKLevel | TIM1_BDTRInitStruct->TIM1_DeadTime |
    611          			 TIM1_BDTRInitStruct->TIM1_Break | TIM1_BDTRInitStruct->TIM1_BreakPolarity |
    612                       TIM1_BDTRInitStruct->TIM1_AutomaticOutput;
    613          
    614            TIM1->BDTR.Data = tmpbdtr;
    615          }
    616          
    617          /*******************************************************************************
    618          * Function Name  : TIM1_ICInit
    619          * Description    : Initializes the TIM1 peripheral according to the specified
    620          *                  parameters in the TIM1_ICInitStruct.
    621          * Input          : - TIM1_ICInitStruct: pointer to a TIM1_ICInitTypeDef structure
    622          *                    that contains the configuration information for the specified
    623          *                    TIM1 peripheral.
    624          * Output         : None
    625          * Return         : None
    626          *******************************************************************************/
    627          void TIM1_ICInit(TIM1_ICInitTypeDef* TIM1_ICInitStruct)
    628          {
    629            /* Check the parameters */
    630            assert(IS_TIM1_CHANNEL(TIM1_ICInitStruct->TIM1_Channel));
    631            assert(IS_TIM1_IC_POLARITY(TIM1_ICInitStruct->TIM1_ICPolarity));
    632            assert(IS_TIM1_IC_SELECTION(TIM1_ICInitStruct->TIM1_ICSelection));
    633            assert(IS_TIM1_IC_PRESCALER(TIM1_ICInitStruct->TIM1_ICPrescaler));
    634            assert(IS_TIM1_IC_FILTER(TIM1_ICInitStruct->TIM1_ICFilter));
    635          
    636            if (TIM1_ICInitStruct->TIM1_Channel == TIM1_Channel_1)
    637            {
    638              /* TI1 Configuration */
    639              TI1_Config(TIM1_ICInitStruct->TIM1_ICPolarity,
    640                         TIM1_ICInitStruct->TIM1_ICSelection,
    641                         TIM1_ICInitStruct->TIM1_ICFilter);
    642          
    643              /* Set the Input Capture Prescaler value */
    644              TIM1_SetIC1Prescaler(TIM1_ICInitStruct->TIM1_ICPrescaler);
    645            }
    646            else if (TIM1_ICInitStruct->TIM1_Channel == TIM1_Channel_2)
    647            {
    648              /* TI2 Configuration */
    649              TI2_Config(TIM1_ICInitStruct->TIM1_ICPolarity,
    650                         TIM1_ICInitStruct->TIM1_ICSelection,
    651                         TIM1_ICInitStruct->TIM1_ICFilter);
    652          
    653              /* Set the Input Capture Prescaler value */
    654              TIM1_SetIC2Prescaler(TIM1_ICInitStruct->TIM1_ICPrescaler);
    655            }
    656            else if (TIM1_ICInitStruct->TIM1_Channel == TIM1_Channel_3)
    657            {
    658              /* TI3 Configuration */
    659              TI3_Config(TIM1_ICInitStruct->TIM1_ICPolarity,
    660                         TIM1_ICInitStruct->TIM1_ICSelection,
    661                         TIM1_ICInitStruct->TIM1_ICFilter);
    662          
    663              /* Set the Input Capture Prescaler value */
    664              TIM1_SetIC3Prescaler(TIM1_ICInitStruct->TIM1_ICPrescaler);
    665            }
    666            else
    667            {
    668              /* TI4 Configuration */
    669              TI4_Config(TIM1_ICInitStruct->TIM1_ICPolarity,
    670                         TIM1_ICInitStruct->TIM1_ICSelection,
    671                         TIM1_ICInitStruct->TIM1_ICFilter);
    672          
    673              /* Set the Input Capture Prescaler value */
    674              TIM1_SetIC4Prescaler(TIM1_ICInitStruct->TIM1_ICPrescaler);
    675            }
    676          }
    677          
    678          /*******************************************************************************
    679          * Function Name  : TIM1_PWMIConfig
    680          * Description    : Configures the TIM1 peripheral in PWM Input Mode according 
    681          *                  to the specified parameters in the TIM1_ICInitStruct.
    682          * Input          : - TIM1_ICInitStruct: pointer to a TIM1_ICInitTypeDef structure
    683          *                    that contains the configuration information for the specified
    684          *                    TIM1 peripheral.
    685          * Output         : None
    686          * Return         : None
    687          *******************************************************************************/
    688          void TIM1_PWMIConfig(TIM1_ICInitTypeDef* TIM1_ICInitStruct)
    689          {
    690            u8 ICPolarity = TIM1_ICPolarity_Rising;
    691            u8 ICSelection = TIM1_ICSelection_DirectTI;
    692          
    693            /* Check the parameters */
    694            assert(IS_TIM1_PWMI_CHANNEL(TIM1_ICInitStruct->TIM1_Channel));
    695            assert(IS_TIM1_IC_POLARITY(TIM1_ICInitStruct->TIM1_ICPolarity));
    696            assert(IS_TIM1_IC_SELECTION(TIM1_ICInitStruct->TIM1_ICSelection));
    697            assert(IS_TIM1_IC_PRESCALER(TIM1_ICInitStruct->TIM1_ICPrescaler));
    698          
    699            /* Select the Opposite Input Polarity */
    700            if (TIM1_ICInitStruct->TIM1_ICPolarity == TIM1_ICPolarity_Rising)
    701            {
    702              ICPolarity = TIM1_ICPolarity_Falling;
    703            }
    704            else
    705            {
    706              ICPolarity = TIM1_ICPolarity_Rising;
    707            }
    708          
    709            /* Select the Opposite Input */
    710            if (TIM1_ICInitStruct->TIM1_ICSelection == TIM1_ICSelection_DirectTI)
    711            {
    712              ICSelection = TIM1_ICSelection_IndirectTI;
    713            }
    714            else
    715            {
    716              ICSelection = TIM1_ICSelection_DirectTI;
    717            }
    718          
    719            if (TIM1_ICInitStruct->TIM1_Channel == TIM1_Channel_1)
    720            {
    721              /* TI1 Configuration */
    722              TI1_Config(TIM1_ICInitStruct->TIM1_ICPolarity, TIM1_ICInitStruct->TIM1_ICSelection,
    723                         TIM1_ICInitStruct->TIM1_ICFilter);
    724          
    725              /* Set the Input Capture Prescaler value */
    726              TIM1_SetIC1Prescaler(TIM1_ICInitStruct->TIM1_ICPrescaler);
    727          
    728              /* TI2 Configuration */
    729              TI2_Config(ICPolarity, ICSelection, TIM1_ICInitStruct->TIM1_ICFilter);
    730          
    731              /* Set the Input Capture Prescaler value */
    732              TIM1_SetIC2Prescaler(TIM1_ICInitStruct->TIM1_ICPrescaler);
    733            }
    734            else
    735            {	 
    736              /* TI2 Configuration */
    737              TI2_Config(TIM1_ICInitStruct->TIM1_ICPolarity, TIM1_ICInitStruct->TIM1_ICSelection,
    738                         TIM1_ICInitStruct->TIM1_ICFilter);
    739          
    740              /* Set the Input Capture Prescaler value */
    741              TIM1_SetIC2Prescaler(TIM1_ICInitStruct->TIM1_ICPrescaler);
    742          
    743              /* TI1 Configuration */
    744              TI1_Config(ICPolarity, ICSelection, TIM1_ICInitStruct->TIM1_ICFilter);
    745          
    746              /* Set the Input Capture Prescaler value */
    747              TIM1_SetIC1Prescaler(TIM1_ICInitStruct->TIM1_ICPrescaler);
    748            }
    749          }
    750          /*******************************************************************************
    751          * Function Name  : TIM1_OCStructInit
    752          * Description    : Fills each TIM1_OCInitStruct member with its default value.
    753          * Input          : - TIM1_OCInitStruct : pointer to a TIM1_OCInitTypeDef structure
    754          *                    which will be initialized.
    755          * Output         : None
    756          * Return         : None
    757          *******************************************************************************/
    758          void TIM1_OCStructInit(TIM1_OCInitTypeDef* TIM1_OCInitStruct)
    759          {
    760            /* Set the default configuration */
    761            TIM1_OCInitStruct->TIM1_OCMode = TIM1_OCMode_Timing;
    762            TIM1_OCInitStruct->TIM1_OutputState = TIM1_OutputState_Disable;
    763            TIM1_OCInitStruct->TIM1_OutputNState = TIM1_OutputNState_Disable;
    764            TIM1_OCInitStruct->TIM1_Pulse = TIM1_Pulse_Reset_Mask;
    765            TIM1_OCInitStruct->TIM1_OCPolarity = TIM1_OCPolarity_High;
    766            TIM1_OCInitStruct->TIM1_OCNPolarity = TIM1_OCPolarity_High;
    767            TIM1_OCInitStruct->TIM1_OCIdleState = TIM1_OCIdleState_Reset;
    768            TIM1_OCInitStruct->TIM1_OCNIdleState = TIM1_OCNIdleState_Reset;
    769          }
    770          
    771          /*******************************************************************************
    772          * Function Name  : TIM1_ICStructInit
    773          * Description    : Fills each TIM1_ICInitStruct member with its default value.
    774          * Input          : - TIM1_ICInitStruct : pointer to a TIM1_ICInitTypeDef structure
    775          *                    which will be initialized.
    776          * Output         : None
    777          * Return         : None
    778          *******************************************************************************/
    779          void TIM1_ICStructInit(TIM1_ICInitTypeDef* TIM1_ICInitStruct)
    780          {
    781            /* Set the default configuration */
    782            TIM1_ICInitStruct->TIM1_Channel = TIM1_Channel_1;
    783            TIM1_ICInitStruct->TIM1_ICSelection = TIM1_ICSelection_DirectTI;
    784            TIM1_ICInitStruct->TIM1_ICPolarity = TIM1_ICPolarity_Rising;
    785            TIM1_ICInitStruct->TIM1_ICPrescaler = TIM1_ICPSC_DIV1;
    786            TIM1_ICInitStruct->TIM1_ICFilter = TIM1_ICFilter_Mask;
    787          }
    788          
    789          /*******************************************************************************
    790          * Function Name  : TIM1_TimeBaseStructInit
    791          * Description    : Fills each TIM1_TimeBaseInitStruct member with its default value.
    792          * Input          : - TIM1_TimeBaseInitStruct : pointer to a TIM1_TimeBaseInitTypeDef
    793          *                    structure which will be initialized.
    794          * Output         : None
    795          * Return         : None
    796          *******************************************************************************/
    797          void TIM1_TimeBaseStructInit(TIM1_TimeBaseInitTypeDef* TIM1_TimeBaseInitStruct)
    798          {
    799            /* Set the default configuration */
    800            TIM1_TimeBaseInitStruct->TIM1_Period = TIM1_Period_Reset_Mask;
    801            TIM1_TimeBaseInitStruct->TIM1_Prescaler = TIM1_Prescaler_Reset_Mask;
    802            TIM1_TimeBaseInitStruct->TIM1_ClockDivision = __TIM1_CKD_DIV1;
    803            TIM1_TimeBaseInitStruct->TIM1_CounterMode = __TIM1_UPCNT;
    804            TIM1_TimeBaseInitStruct->TIM1_RepetitionCounter = TIM1_RepetitionCounter_Reset_Mask;
    805          }
    806          
    807          /*******************************************************************************
    808          * Function Name  : TIM1_BDTRStructInit
    809          * Description    : Fills each TIM1_BDTRInitStruct member with its default value.
    810          * Input          : - TIM1_BDTRInitStruct : pointer to a TIM1_BDTRInitTypeDef
    811          *                    structure which will be initialized.
    812          * Output         : None
    813          * Return         : None
    814          *******************************************************************************/
    815          void TIM1_BDTRStructInit(TIM1_BDTRInitTypeDef* TIM1_BDTRInitStruct)
    816          {
    817            /* Set the default configuration */
    818            TIM1_BDTRInitStruct->TIM1_OSSRState = TIM1_OSSRState_Disable;
    819            TIM1_BDTRInitStruct->TIM1_OSSIState = TIM1_OSSIState_Disable;
    820            TIM1_BDTRInitStruct->TIM1_LOCKLevel = TIM1_LOCKLevel_OFF;
    821            TIM1_BDTRInitStruct->TIM1_DeadTime = TIM1_DeadTime_Reset_Mask;
    822            TIM1_BDTRInitStruct->TIM1_Break = TIM1_Break_Disable;
    823            TIM1_BDTRInitStruct->TIM1_BreakPolarity = TIM1_BreakPolarity_Low;
    824            TIM1_BDTRInitStruct->TIM1_AutomaticOutput = TIM1_AutomaticOutput_Disable;
    825          }
    826          
    827          /*******************************************************************************
    828          * Function Name  : TIM1_Cmd
    829          * Description    : Enables or disables the TIM1 peripheral.
    830          * Input          : - Newstate: new state of the TIM1 peripheral.
    831          *                    This parameter can be: ENABLE or DISABLE.
    832          * Output         : None
    833          * Return         : None
    834          *******************************************************************************/
    835          void TIM1_Cmd(u32 NewState)
    836          {
    837              // set or Reset the CEN Bit
    838              *(vu32 *) CR1_CEN_BB = (u16)NewState;
    839          }
    840          
    841          /*******************************************************************************
    842          * Function Name  : TIM1_CtrlPWMOutputs
    843          * Description    : Enables or disables the TIM1 peripheral Main Outputs.
    844          * Input          : - Newstate: new state of the TIM1 peripheral Main Outputs.
    845          *                    This parameter can be: ENABLE or DISABLE.
    846          * Output         : None
    847          * Return         : None
    848          *******************************************************************************/
    849          void TIM1_CtrlPWMOutputs(u32 Newstate)
    850          {
    851              /* Check the parameters */
    852            //  assert(IS_FUNCTIONAL_STATE(Newstate));
    853            
    854              /* Set or Reset the MOE Bit */
    855              *(vu32 *) BDTR_MOE_BB = (u16)Newstate;
    856            //	TIM1->BDTR.Bit.MOE = SET;
    857          }
    858          
    859          /*******************************************************************************
    860          * Function Name  : TIM1_ITConfig
    861          * Description    : Enables or disables the specified TIM1 interrupts.
    862          * Input          : - TIM1_IT: specifies the TIM1 interrupts sources to be enabled
    863          *                    or disabled.
    864          *                    This parameter can be any combination of the following values:
    865          *                       - TIM1_IT_Update: TIM1 update Interrupt source
    866          *                       - TIM1_IT_CC1: TIM1 Capture Compare 1 Interrupt source
    867          *                       - TIM1_IT_CC2: TIM1 Capture Compare 2 Interrupt source
    868          *                       - TIM1_IT_CC3: TIM1 Capture Compare 3 Interrupt source
    869          *                       - TIM1_IT_CC4: TIM1 Capture Compare 4 Interrupt source
    870          *                       - TIM1_IT_CCUpdate: TIM1 Capture Compare Update Interrupt
    871          *                         source
    872          *                       - TIM1_IT_Trigger: TIM1 Trigger Interrupt source
    873          *                       - TIM1_IT_Break: TIM1 Break Interrupt source
    874          *                  - Newstate: new state of the TIM1 interrupts.
    875          *                    This parameter can be: ENABLE or DISABLE.
    876          * Output         : None
    877          * Return         : None
    878          *******************************************************************************/
    879          void TIM1_ITConfig(u16 TIM1_IT, u32 NewState)
    880          {
    881              /* Check the parameters */
    882              assert(IS_TIM1_IT(TIM1_IT));
    883              assert(IS_FUNCTIONAL_STATE(NewState));
    884            
    885              if (NewState == ENABLE)
    886              {
    887                  /* Enable the Interrupt sources */
    888                  TIM1->DIER.Data |= TIM1_IT;
    889              }
    890              else
    891              {
    892                  /* Disable the Interrupt sources */
    893                  TIM1->DIER.Data &= (u16)~TIM1_IT;
    894              }
    895          }
    896          
    897          /*******************************************************************************
    898          * Function Name  : TIM1_DMAConfig
    899          * Description    : Configures the TIM1s DMA interface.
    900          * Input          : - TIM1_DMABase: DMA Base address.
    901          *                    This parameter can be one of the following values:
    902          *                       - TIM1_DMABase_CR1, TIM1_DMABase_CR2, TIM1_DMABase_SMCR,
    903          *                         TIM1_DMABase_DIER, TIM1_DMABase_SR, TIM1_DMABase_EGR,
    904          *                         TIM1_DMABase_CCMR1, TIM1_DMABase_CCMR2, TIM1_DMABase_CCER,
    905          *                         TIM1_DMABase_CNT, TIM1_DMABase_PSC, TIM1_DMABase_ARR,
    906          *                         TIM1_DMABase_RCR, TIM1_DMABase_CCR1, TIM1_DMABase_CCR2,
    907          *                         TIM1_DMABase_CCR3, TIM1_DMABase_CCR4, TIM1_DMABase_BDTR,
    908          *                         TIM1_DMABase_DCR.
    909          *                   - TIM1_DMABurstLength: DMA Burst length.
    910          *                     This parameter can be one value between:
    911          *                     TIM1_DMABurstLength_1Byte and TIM1_DMABurstLength_18Bytes.
    912          * Output         : None
    913          * Return         : None
    914          *******************************************************************************/
    915          void TIM1_DMAConfig(u16 TIM1_DMABase, u16 TIM1_DMABurstLength)
    916          {
    917            u32 tmpdcr = 0;
    918          
    919            /* Check the parameters */
    920            assert(IS_TIM1_DMA_BASE(TIM1_DMABase));
    921            assert(IS_TIM1_DMA_LENGTH(TIM1_DMABurstLength));
    922          
    923            tmpdcr = TIM1->DCR.Data;
    924          
    925            /* Reset the DBA and the DBL Bits */
    926            tmpdcr &= DCR_DMA_Mask;
    927          
    928            /* Set the DMA Base and the DMA Burst Length */
    929            tmpdcr |= TIM1_DMABase | TIM1_DMABurstLength;
    930          
    931            TIM1->DCR.Data = (u16)tmpdcr;
    932          }
    933          
    934          /*******************************************************************************
    935          * Function Name  : TIM1_DMACmd
    936          * Description    : Enables or disables the TIM1s DMA Requests.
    937          * Input          : - TIM1_DMASources: specifies the DMA Request sources.
    938          *                    This parameter can be any combination of the following values:
    939          *                       - TIM1_DMA_Update: TIM1 update Interrupt source
    940          *                       - TIM1_DMA_CC1: TIM1 Capture Compare 1 DMA source
    941          *                       - TIM1_DMA_CC2: TIM1 Capture Compare 2 DMA source
    942          *                       - TIM1_DMA_CC3: TIM1 Capture Compare 3 DMA source
    943          *                       - TIM1_DMA_CC4: TIM1 Capture Compare 4 DMA source
    944          *                       - TIM1_DMA_COM: TIM1 Capture Compare Update DMA
    945          *                         source
    946          *                       - TIM1_DMA_Trigger: TIM1 Trigger DMA source
    947          *                  - Newstate: new state of the DMA Request sources.
    948          *                    This parameter can be: ENABLE or DISABLE.
    949          * Output         : None
    950          * Return         : None
    951          *******************************************************************************/
    952          void TIM1_DMACmd(u16 TIM1_DMASource, u32 Newstate)
    953          {
    954              u32 tmpdier = 0;
    955            
    956              /* Check the parameters */
    957              assert(IS_TIM1_DMA_SOURCE(TIM1_DMASource));
    958              assert(IS_FUNCTIONAL_STATE(Newstate));
    959            
    960              tmpdier = TIM1->DIER.Data;
    961            
    962              if (Newstate == ENABLE)
    963              {
    964                  /* Enable the DMA sources */
    965                  tmpdier |= TIM1_DMASource;
    966              }
    967              else
    968              {
    969                  /* Disable the DMA sources */
    970                  tmpdier &= (u16)~TIM1_DMASource;
    971              }
    972              TIM1->DIER.Data = (u16)tmpdier;
    973          }
    974          
    975          /*******************************************************************************
    976          * Function Name  : TIM1_InternalClockConfig
    977          * Description    : Configures the TIM1 interrnal Clock
    978          * Input          : None
    979          * Output         : None
    980          * Return         : None
    981          *******************************************************************************/
    982          void TIM1_InternalClockConfig(void)
    983          {
    984            /* Disable slave mode to clock the prescaler directly with the internal clock */
    985            TIM1->SMCR.Data &=  SMCR_SMS_Mask;
    986          }
    987          /*******************************************************************************
    988          * Function Name  : TIM1_ETRClockMode1Config
    989          * Description    : Configures the TIM1 External clock Mode1
    990          * Input          : - TIM1_ExtTRGPrescaler: The external Trigger Prescaler.
    991          *                    It can be one of the following values:
    992          *                       - TIM1_ExtTRGPSC_OFF
    993          *                       - TIM1_ExtTRGPSC_DIV2
    994          *                       - TIM1_ExtTRGPSC_DIV4
    995          *                       - TIM1_ExtTRGPSC_DIV8.
    996          *                  - TIM1_ExtTRGPolarity: The external Trigger Polarity.
    997          *                    It can be one of the following values:
    998          *                       - TIM1_ExtTRGPolarity_Inverted
    999          *                       - TIM1_ExtTRGPolarity_NonInverted
   1000          *                  - ExtTRGFilter: External Trigger Filter.
   1001          *                    This parameter must be a value between 0x00 and 0x0F
   1002          * Output         : None
   1003          * Return         : None
   1004          *******************************************************************************/
   1005          void TIM1_ETRClockMode1Config(u16 TIM1_ExtTRGPrescaler, u16 TIM1_ExtTRGPolarity,
   1006                                       u16 ExtTRGFilter)
   1007          {
   1008            /* Check the parameters */
   1009            assert(IS_TIM1_EXT_PRESCALER(TIM1_ExtTRGPrescaler));
   1010            assert(IS_TIM1_EXT_POLARITY(TIM1_ExtTRGPolarity));
   1011          
   1012            /* Configure the ETR Clock source */
   1013            TIM1_ETRConfig(TIM1_ExtTRGPrescaler, TIM1_ExtTRGPolarity, ExtTRGFilter);
   1014          
   1015            /* Select the External clock mode1 */
   1016            TIM1->SMCR.Data &= SMCR_SMS_Mask;
   1017            TIM1->SMCR.Data |= TIM1_SlaveMode_External1;
   1018            
   1019            /* Select the Trigger selection : ETRF */
   1020            TIM1->SMCR.Data &= SMCR_TS_Mask;
   1021            TIM1->SMCR.Data |= TIM1_TS_ETRF;
   1022          }
   1023          
   1024          /*******************************************************************************
   1025          * Function Name  : TIM1_ETRClockMode2Config
   1026          * Description    : Configures the TIM1 External clock Mode2
   1027          * Input          : - TIM1_ExtTRGPrescaler: The external Trigger Prescaler.
   1028          *                    It can be one of the following values:
   1029          *                       - TIM1_ExtTRGPSC_OFF
   1030          *                       - TIM1_ExtTRGPSC_DIV2
   1031          *                       - TIM1_ExtTRGPSC_DIV4
   1032          *                       - TIM1_ExtTRGPSC_DIV8
   1033          *                  - TIM1_ExtTRGPolarity: The external Trigger Polarity.
   1034          *                    It can be one of the following values:
   1035          *                       - TIM1_ExtTRGPolarity_Inverted
   1036          *                       - TIM1_ExtTRGPolarity_NonInverted
   1037          *                  - ExtTRGFilter: External Trigger Filter.
   1038          *                    This parameter must be a value between 0x00 and 0x0F
   1039          * Output         : None
   1040          * Return         : None
   1041          *******************************************************************************/
   1042          void TIM1_ETRClockMode2Config(u16 TIM1_ExtTRGPrescaler, u16 TIM1_ExtTRGPolarity,
   1043                                       u16 ExtTRGFilter)
   1044          {
   1045            /* Check the parameters */
   1046            assert(IS_TIM1_EXT_PRESCALER(TIM1_ExtTRGPrescaler));
   1047            assert(IS_TIM1_EXT_POLARITY(TIM1_ExtTRGPolarity));
   1048          
   1049            /* Configure the ETR Clock source */
   1050            TIM1_ETRConfig(TIM1_ExtTRGPrescaler, TIM1_ExtTRGPolarity, ExtTRGFilter);
   1051          
   1052            /* Enable the External clock mode2 */
   1053            *(vu32 *) SMCR_ECE_BB = SMCR_ECE_Set;
   1054          }
   1055          
   1056          /*******************************************************************************
   1057          * Function Name  : TIM1_ETRConfig
   1058          * Description    : Configures the TIM1 External Trigger (ETR).
   1059          * Input          : - TIM1_ExtTRGPrescaler: The external Trigger Prescaler.
   1060          *                    This parameter can be one of the following values:
   1061          *                       - TIM1_ExtTRGPSC_OFF
   1062          *                       - TIM1_ExtTRGPSC_DIV2
   1063          *                       - TIM1_ExtTRGPSC_DIV4
   1064          *                       - TIM1_ExtTRGPSC_DIV8
   1065          *                  - TIM1_ExtTRGPolarity: The external Trigger Polarity.
   1066          *                    This parameter can be one of the following values:
   1067          *                       - TIM1_ExtTRGPolarity_Inverted
   1068          *                       - TIM1_ExtTRGPolarity_NonInverted
   1069          *                  - ExtTRGFilter: External Trigger Filter.
   1070          *                    This parameter must be a value between 0x00 and 0x0F.
   1071          * Output         : None
   1072          * Return         : None
   1073          *******************************************************************************/
   1074          void TIM1_ETRConfig(u16 TIM1_ExtTRGPrescaler, u16 TIM1_ExtTRGPolarity,
   1075                              u16 ExtTRGFilter)
   1076          {
   1077            u32 tmpsmcr = 0;
   1078          
   1079            tmpsmcr = TIM1->SMCR.Data;
   1080          
   1081            /* Set the Prescaler, the Filter value and the Polarity */
   1082            tmpsmcr &= SMCR_ETR_Mask;
   1083            tmpsmcr |= TIM1_ExtTRGPrescaler | TIM1_ExtTRGPolarity | (u16)((u16)ExtTRGFilter << 8);
   1084          
   1085            TIM1->SMCR.Data = (u16)tmpsmcr;
   1086          }
   1087          
   1088          /*******************************************************************************
   1089          * Function Name  : TIM1_ITRxExternalClockConfig
   1090          * Description    : Configures the TIM1 Internal Trigger as External Clock
   1091          * Input          : - TIM1_ITRSource: Internal Trigger source.
   1092          *                    This parameter can be one of the following values:
   1093          *                       - TIM1_TS_ITR0: Internal Trigger 0
   1094          *                       - TIM1_TS_ITR1: Internal Trigger 1
   1095          *                       - TIM1_TS_ITR2: Internal Trigger 2
   1096          *                       - TIM1_TS_ITR3: Internal Trigger 3
   1097          * Output         : None
   1098          * Return         : None
   1099          *******************************************************************************/
   1100          void TIM1_ITRxExternalClockConfig(u16 TIM1_InputTriggerSource)
   1101          {
   1102            /* Check the parameters */
   1103            assert(IS_TIM1_INTERNAL_TRIGGER_SELECTION(TIM1_InputTriggerSource));
   1104            
   1105            /* Select the Internal Trigger */
   1106            TIM1_SelectInputTrigger(TIM1_InputTriggerSource);
   1107          
   1108            /* Select the External clock mode1 */
   1109            TIM1->SMCR.Data |= TIM1_SlaveMode_External1;
   1110          }
   1111          
   1112          /*******************************************************************************
   1113          * Function Name  : TIM1_TIxExternalClockConfig
   1114          * Description    : Configures the TIM1 Trigger as External Clock
   1115          * Input          : - TIM1_TIxExternalCLKSource: Trigger source.
   1116          *                    This parameter can be one of the following values:
   1117          *                       - TIM1_TS_TI1F_ED: TI1 Edge Detector
   1118          *                       - TIM1_TS_TI1FP1: Filtered TIM1 Input 1
   1119          *                       - TIM1_TS_TI2FP2: Filtered TIM1 Input 2
   1120          *                  - TIM1_ICPolarity: specifies the TIx Polarity.
   1121          *                    This parameter can be:
   1122          *                       - TIM1_ICPolarity_Rising
   1123          *                       - TIM1_ICPolarity_Falling
   1124          *                   - ICFilter : specifies the filter value.
   1125          *                     This parameter must be a value between 0x0 and 0xF.
   1126          * Output         : None
   1127          * Return         : None
   1128          *******************************************************************************/
   1129          void TIM1_TIxExternalClockConfig(u16 TIM1_TIxExternalCLKSource,
   1130                                          u16 TIM1_ICPolarity, u8 ICFilter)
   1131          {
   1132            /* Check the parameters */
   1133            assert(IS_TIM1_TIX_TRIGGER_SELECTION(TIM1_TIxExternalCLKSource));
   1134            assert(IS_TIM1_IC_POLARITY(TIM1_ICPolarity));
   1135            assert(IS_TIM1_IC_FILTER(ICFilter));
   1136          
   1137            /* Configure the TIM1 Input Clock Source */
   1138            if (TIM1_TIxExternalCLKSource == TIM1_TIxExternalCLK1Source_TI2)
   1139            {
   1140              TI2_Config(TIM1_ICPolarity, TIM1_ICSelection_DirectTI, ICFilter);
   1141            }
   1142            else
   1143            {
   1144              TI1_Config(TIM1_ICPolarity, TIM1_ICSelection_DirectTI, ICFilter);
   1145            }
   1146          
   1147            /* Select the Trigger source */
   1148            TIM1_SelectInputTrigger(TIM1_TIxExternalCLKSource);
   1149          
   1150            /* Select the External clock mode1 */
   1151            TIM1->SMCR.Data |= TIM1_SlaveMode_External1;
   1152          }
   1153          /*******************************************************************************
   1154          * Function Name  : TIM1_SelectInputTrigger
   1155          * Description    : Selects the TIM1 Input Trigger source
   1156          * Input          : - TIM1_InputTriggerSource: The Trigger source.
   1157          *                    This parameter can be one of the following values:
   1158          *                       - TIM1_TS_ITR0: Internal Trigger 0
   1159          *                       - TIM1_TS_ITR1: Internal Trigger 1
   1160          *                       - TIM1_TS_ITR2: Internal Trigger 2
   1161          *                       - TIM1_TS_ITR3: Internal Trigger 3
   1162          *                       - TIM1_TS_TI1F_ED: TI1 Edge Detector
   1163          *                       - TIM1_TS_TI1FP1: Filtered Timer Input 1
   1164          *                       - TIM1_TS_TI2FP2: Filtered Timer Input 2
   1165          *                       - TIM1_TS_ETRF: External Trigger input
   1166          * Output         : None
   1167          * Return         : None
   1168          *******************************************************************************/
   1169          void TIM1_SelectInputTrigger(u16 TIM1_InputTriggerSource)
   1170          {
   1171            u32 tmpsmcr = 0;
   1172          
   1173            /* Check the parameters */
   1174            assert(IS_TIM1_TRIGGER_SELECTION(TIM1_InputTriggerSource));
   1175          
   1176            tmpsmcr = TIM1->SMCR.Data;
   1177          
   1178            /* Select the Tgigger Source */
   1179            tmpsmcr &= SMCR_TS_Mask;
   1180            tmpsmcr |= TIM1_InputTriggerSource;
   1181          
   1182            TIM1->SMCR.Data = (u16)tmpsmcr;
   1183          }
   1184          
   1185          /*******************************************************************************
   1186          * Function Name  : TIM1_UpdateDisableConfig
   1187          * Description    : Enables or Disables the TIM1 Update event.
   1188          * Input          : - Newstate: new state of the TIM1 peripheral Preload register
   1189          *                    This parameter can be: ENABLE or DISABLE.
   1190          * Output         : None
   1191          * Return         : None
   1192          *******************************************************************************/
   1193          void TIM1_UpdateDisableConfig(u32 Newstate)
   1194          {
   1195            /* Check the parameters */
   1196            assert(IS_FUNCTIONAL_STATE(Newstate));
   1197          
   1198            /* Set or Reset the UDIS Bit */
   1199            *(vu32 *) CR1_UDIS_BB = (u16)Newstate;
   1200          }
   1201          
   1202          /*******************************************************************************
   1203          * Function Name  : TIM1_UpdateRequestConfig
   1204          * Description    : Selects the TIM1 Update Request Interrupt source.
   1205          * Input          : - TIM1_UpdateSource: specifies the Update source.
   1206          *                    This parameter can be one of the following values:
   1207          *                       - TIM1_UpdateSource_Regular
   1208          *                       - TIM1_UpdateSource_Global
   1209          * Output         : None
   1210          * Return         : None
   1211          *******************************************************************************/
   1212          void TIM1_UpdateRequestConfig(u8 TIM1_UpdateSource)
   1213          {
   1214            /* Check the parameters */
   1215            assert(IS_TIM1_UPDATE_SOURCE(TIM1_UpdateSource));
   1216          
   1217            /* Set or Reset the URS Bit */
   1218            *(vu32 *) CR1_URS_BB = TIM1_UpdateSource;
   1219          }
   1220          
   1221          /*******************************************************************************
   1222          * Function Name  : TIM1_SelectHallSensor
   1223          * Description    : Enables or disables the TIM1s Hall sensor interface.
   1224          * Input          : - Newstate: new state of the TIM1 Hall sensor interface
   1225          * Output         : None
   1226          * Return         : None
   1227          *******************************************************************************/
   1228          void TIM1_SelectHallSensor(u32 Newstate)
   1229          {
   1230              /* Check the parameters */
   1231              assert(IS_FUNCTIONAL_STATE(Newstate));
   1232            
   1233              /* Set or Reset the TI1S Bit */
   1234              *(vu32 *) CR2_TI1S_BB = (u16)Newstate;
   1235          }
   1236          
   1237          /*******************************************************************************
   1238          * Function Name  : TIM1_SelectOPM
   1239          * Description    : Enables or disables the TIM1s One Pulse Mode.
   1240          * Input          : - TIM1_OPMode: specifies the OPM Mode to be used.
   1241          *                    This parameter can be one of the following values:
   1242          *                    - TIM1_OPMode_Single
   1243          *                    - TIM1_OPMode_Repetitive
   1244          * Output         : None
   1245          * Return         : None
   1246          *******************************************************************************/
   1247          void TIM1_SelectOnePulseMode(u16 TIM1_OPMode)
   1248          {
   1249            /* Check the parameters */
   1250            assert(IS_TIM1_OPM_MODE(TIM1_OPMode));
   1251          
   1252            /* Set or Reset the OPM Bit */
   1253            *(vu32 *) CR1_OPM_BB = TIM1_OPMode;
   1254          }
   1255          
   1256          /*******************************************************************************
   1257          * Function Name  : TIM1_SelectOutputTrigger
   1258          * Description    : Selects the TIM1 Trigger Output Mode.
   1259          * Input          : - TIM1_TRGOSource: specifies the Trigger Output source.
   1260          *                    This paramter can be one of the following values:
   1261          *                       - TIM1_TRGOSource_Reset
   1262          *                       - TIM1_TRGOSource_Enable
   1263          *                       - TIM1_TRGOSource_Update
   1264          *                       - TIM1_TRGOSource_OC1
   1265          *                       - TIM1_TRGOSource_OC1Ref
   1266          *                       - TIM1_TRGOSource_OC2Ref
   1267          *                       - TIM1_TRGOSource_OC3Ref
   1268          *                       - TIM1_TRGOSource_OC4Ref
   1269          * Output         : None
   1270          * Return         : None
   1271          *******************************************************************************/
   1272          void TIM1_SelectOutputTrigger(u16 TIM1_TRGOSource)
   1273          {
   1274            u32 tmpcr2 = 0;
   1275          
   1276            /* Check the parameters */
   1277            assert(IS_TIM1_TRGO_SOURCE(TIM1_TRGOSource));
   1278          
   1279            tmpcr2 = TIM1->CR2.Data;
   1280          
   1281            /* Reset the MMS Bits */
   1282            tmpcr2 &= CR2_MMS_Mask;
   1283          
   1284            /* Select the TRGO source */
   1285            tmpcr2 |=  TIM1_TRGOSource;
   1286          
   1287            TIM1->CR2.Data = (u16)tmpcr2;
   1288          }
   1289          
   1290          /*******************************************************************************
   1291          * Function Name  : TIM1_SelectSlaveMode
   1292          * Description    : Selects the TIM1 Slave Mode.
   1293          * Input          : - TIM1_SlaveMode: specifies the TIM1 Slave Mode.
   1294          *                    This paramter can be one of the following values:
   1295          *                       - TIM1_SlaveMode_Reset
   1296          *                       - TIM1_SlaveMode_Gated
   1297          *                       - TIM1_SlaveMode_Trigger
   1298          *                       - TIM1_SlaveMode_External1
   1299          * Output         : None
   1300          * Return         : None
   1301          *******************************************************************************/
   1302          void TIM1_SelectSlaveMode(u16 TIM1_SlaveMode)
   1303          {
   1304            u32 tmpsmcr = 0;
   1305          
   1306            /* Check the parameters */
   1307            assert(IS_TIM1_SLAVE_MODE(TIM1_SlaveMode));
   1308          
   1309            tmpsmcr = TIM1->SMCR.Data;
   1310          
   1311            /* Reset the SMS Bits */
   1312            tmpsmcr &= SMCR_SMS_Mask;
   1313          
   1314            /* Select the Slave Mode */
   1315            tmpsmcr |= TIM1_SlaveMode;
   1316          
   1317            TIM1->SMCR.Data = (u16)tmpsmcr;
   1318          }
   1319          
   1320          /*******************************************************************************
   1321          * Function Name  : TIM1_SelectMasterSlaveMode
   1322          * Description    : Sets or Resets the TIM1 Master/Slave Mode.
   1323          * Input          : - TIM1_MasterSlaveMode: specifies the TIM1 Master Slave Mode.
   1324          *                    This paramter can be one of the following values:
   1325          *                       - TIM1_MasterSlaveMode_Enable: synchronization between
   1326          *                         the current timer and its slaves (through TRGO).
   1327          *                       - TIM1_MasterSlaveMode_Disable: No action
   1328          * Output         : None
   1329          * Return         : None
   1330          *******************************************************************************/
   1331          void TIM1_SelectMasterSlaveMode(u16 TIM1_MasterSlaveMode)
   1332          {
   1333            /* Check the parameters */
   1334            assert(IS_TIM1_MSM_STATE(TIM1_MasterSlaveMode));
   1335          
   1336            /* Set or Reset the MSM Bit */
   1337            *(vu32 *) SMCR_MSM_BB = TIM1_MasterSlaveMode;
   1338          }
   1339          
   1340          /*******************************************************************************
   1341          * Function Name  : TIM1_EncoderInterfaceConfig
   1342          * Description    : Configures the TIM1 Encoder Interface.
   1343          * Input          : - TIM1_EncoderMode: specifies the TIM1 Encoder Mode.
   1344          *                    This parameter can be one of the following values:
   1345          *                       - TIM1_EncoderMode_TI1: Counter counts on TI1FP1 edge
   1346          *                         depending on TI2FP2 level.
   1347          *                       - TIM1_EncoderMode_TI2: Counter counts on TI2FP2 edge
   1348          *                         depending on TI1FP1 level.
   1349          *                       - TIM1_EncoderMode_TI12: Counter counts on both TI1FP1 and
   1350          *                         TI2FP2 edges depending on the level of the other input.
   1351          *                  - TIM1_IC1Polarity: specifies the IC1 Polarity
   1352          *                    This parmeter can be one of the following values:
   1353          *                       - TIM1_ICPolarity_Falling
   1354          *                       - TIM1_ICPolarity_Rising
   1355          *                  - TIM1_IC2Polarity: specifies the IC2 Polarity
   1356          *                    This parmeter can be one of the following values:
   1357          *                       - TIM1_ICPolarity_Falling
   1358          *                       - TIM1_ICPolarity_Rising
   1359          * Output         : None
   1360          * Return         : None
   1361          *******************************************************************************/
   1362          void TIM1_EncoderInterfaceConfig(u16 TIM1_EncoderMode, u16 TIM1_IC1Polarity,
   1363                                          u16 TIM1_IC2Polarity)
   1364          {
   1365            u32 tmpsmcr = 0;
   1366            u32 tmpccmr1 = 0;
   1367          
   1368            /* Check the parameters */
   1369            assert(IS_TIM1_ENCODER_MODE(TIM1_EncoderMode));
   1370            assert(IS_TIM1_IC_POLARITY(TIM1_IC1Polarity));
   1371            assert(IS_TIM1_IC_POLARITY(TIM1_IC2Polarity));
   1372          
   1373            tmpsmcr = TIM1->SMCR.Data;
   1374            tmpccmr1 = TIM1->CCMR.Data[0];
   1375          
   1376            /* Set the encoder Mode */
   1377            tmpsmcr &= SMCR_SMS_Mask;
   1378            tmpsmcr |= TIM1_EncoderMode;
   1379          
   1380            /* Select the Capture Compare 1 and the Capture Compare 2 as input */
   1381            tmpccmr1 &= CCMR_CC13S_Mask & CCMR_CC24S_Mask;
   1382            tmpccmr1 |= CCMR_TI13Direct_Set | CCMR_TI24Direct_Set;
   1383          
   1384            /* Set the TI1 and the TI2 Polarities */
   1385            *(vu32 *) CCER_CC1P_BB = TIM1_IC1Polarity;
   1386            *(vu32 *) CCER_CC2P_BB = TIM1_IC2Polarity;
   1387          
   1388            TIM1->SMCR.Data = (u16)tmpsmcr;
   1389          
   1390            TIM1->CCMR.Data[0] = (u16)tmpccmr1;
   1391          }
   1392          
   1393          /*******************************************************************************
   1394          * Function Name  : TIM1_PrescalerConfig
   1395          * Description    : Configures the TIM1 Prescaler.
   1396          * Input          : - Prescaler: specifies the Prescaler Register value
   1397          *                  - TIM1_PSCReloadMode: specifies the TIM1 Prescaler Reload mode.
   1398          *                    This parmeter can be one of the following values:
   1399          *                       - TIM1_PSCReloadMode_Update: The Prescaler is loaded at
   1400          *                         the update event.
   1401          *                       - TIM1_PSCReloadMode_Immediate: The Prescaler is loaded
   1402          *                         immediatly.
   1403          * Output         : None
   1404          * Return         : None
   1405          *******************************************************************************/
   1406          void TIM1_PrescalerConfig(u16 Prescaler, u16 TIM1_PSCReloadMode)
   1407          {
   1408            /* Check the parameters */
   1409            assert(IS_TIM1_PRESCALER_RELOAD(TIM1_PSCReloadMode));
   1410          
   1411            /* Set the Prescaler value */
   1412            TIM1->PSC = Prescaler;
   1413          
   1414            /* Set or reset the UG Bit */
   1415            *(vu32 *) EGR_UG_BB = TIM1_PSCReloadMode;
   1416          }
   1417          /*******************************************************************************
   1418          * Function Name  : TIM1_CounterModeConfig
   1419          * Description    : Specifies the TIM1 Counter Mode to be used.
   1420          * Input          : - TIM1_CounterMode: specifies the Counter Mode to be used
   1421          *                    This parameter can be one of the following values:
   1422          *                       - TIM1_CounterMode_Up: TIM1 Up Counting Mode
   1423          *                       - TIM1_CounterMode_Down: TIM1 Down Counting Mode
   1424          *                       - TIM1_CounterMode_CenterAligned1: TIM1 Center Aligned Mode1
   1425          *                       - TIM1_CounterMode_CenterAligned2: TIM1 Center Aligned Mode2
   1426          *                       - TIM1_CounterMode_CenterAligned3: TIM1 Center Aligned Mode3
   1427          * Output         : None
   1428          * Return         : None
   1429          *******************************************************************************/
   1430          void TIM1_CounterModeConfig(u16 TIM1_CounterMode)
   1431          {
   1432            u32 tmpcr1 = 0;
   1433          
   1434            /* Check the parameters */
   1435            assert(IS_TIM1_COUNTER_MODE(TIM1_CounterMode));
   1436          
   1437            tmpcr1 = TIM1->CR1.Data;
   1438          
   1439            /* Reset the CMS and DIR Bits */
   1440            tmpcr1 &= CR1_CounterMode_Mask;
   1441          
   1442            /* Set the Counter Mode */
   1443            tmpcr1 |= TIM1_CounterMode;
   1444          
   1445            TIM1->CR1.Data = (u16)tmpcr1;
   1446          }
   1447          
   1448          /*******************************************************************************
   1449          * Function Name  : TIM1_ForcedOC1Config
   1450          * Description    : Forces the TIM1 Channel1 output waveform to active or inactive 
   1451          *                  level.
   1452          * Input          : - TIM1_ForcedAction: specifies the forced Action to be set to
   1453          *                    the output waveform.
   1454          *                    This parameter can be one of the following values:
   1455          *                       - TIM1_ForcedAction_Active: Force active level on OC1REF
   1456          *                       - TIM1_ForcedAction_InActive: Force inactive level on
   1457          *                         OC1REF.
   1458          * Output         : None
   1459          * Return         : None
   1460          *******************************************************************************/
   1461          void TIM1_ForcedOC1Config(u16 TIM1_ForcedAction)
   1462          {
   1463            u32 tmpccmr1 = 0;
   1464          
   1465            /* Check the parameters */
   1466            assert(IS_TIM1_FORCED_ACTION(TIM1_ForcedAction));
   1467          
   1468            tmpccmr1 = TIM1->CCMR.Data[0];
   1469          
   1470            /* Reset the OCM Bits */
   1471            tmpccmr1 &= CCMR_OCM13_Mask;
   1472          
   1473            /* Configure The Forced output Mode */
   1474            tmpccmr1 |= TIM1_ForcedAction;
   1475          
   1476            TIM1->CCMR.Data[0] = (u16)tmpccmr1;
   1477          }
   1478          
   1479          /*******************************************************************************
   1480          * Function Name  : TIM1_ForcedOC2Config
   1481          * Description    : Forces the TIM1 Channel2 output waveform to active or inactive 
   1482          *                  level.
   1483          * Input          : - TIM1_ForcedAction: specifies the forced Action to be set to
   1484          *                    the output waveform.
   1485          *                    This parameter can be one of the following values:
   1486          *                       - TIM1_ForcedAction_Active: Force active level on OC2REF
   1487          *                       - TIM1_ForcedAction_InActive: Force inactive level on
   1488          *                         OC2REF.
   1489          * Output         : None
   1490          * Return         : None
   1491          *******************************************************************************/
   1492          void TIM1_ForcedOC2Config(u16 TIM1_ForcedAction)
   1493          {
   1494            u32 tmpccmr1 = 0;
   1495          
   1496            /* Check the parameters */
   1497            assert(IS_TIM1_FORCED_ACTION(TIM1_ForcedAction));
   1498          
   1499            tmpccmr1 = TIM1->CCMR.Data[0];
   1500          
   1501            /* Reset the OCM Bits */
   1502            tmpccmr1 &= CCMR_OCM24_Mask;
   1503          
   1504            /* Configure The Forced output Mode */
   1505            tmpccmr1 |= (u32)TIM1_ForcedAction << 8;
   1506          
   1507            TIM1->CCMR.Data[0] = (u16)tmpccmr1;
   1508          }
   1509          
   1510          /*******************************************************************************
   1511          * Function Name  : TIM1_ForcedOC3Config
   1512          * Description    : Forces the TIM1 Channel3 output waveform to active or inactive 
   1513          *                  level.
   1514          * Input          : - TIM1_ForcedAction: specifies the forced Action to be set to
   1515          *                    the output waveform.
   1516          *                    This parameter can be one of the following values:
   1517          *                       - TIM1_ForcedAction_Active: Force active level on OC3REF
   1518          *                       - TIM1_ForcedAction_InActive: Force inactive level on
   1519          *                         OC3REF.
   1520          * Output         : None
   1521          * Return         : None
   1522          *******************************************************************************/
   1523          void TIM1_ForcedOC3Config(u16 TIM1_ForcedAction)
   1524          {
   1525            u32 tmpccmr2 = 0;
   1526          
   1527            /* Check the parameters */
   1528            assert(IS_TIM1_FORCED_ACTION(TIM1_ForcedAction));
   1529          
   1530            tmpccmr2 = TIM1->CCMR.Data[1];
   1531          
   1532            /* Reset the OCM Bits */
   1533            tmpccmr2 &= CCMR_OCM13_Mask;
   1534          
   1535            /* Configure The Forced output Mode */
   1536            tmpccmr2 |= TIM1_ForcedAction;
   1537          
   1538            TIM1->CCMR.Data[1] = (u16)tmpccmr2;
   1539          }
   1540          
   1541          /*******************************************************************************
   1542          * Function Name  : TIM1_ForcedOC4Config
   1543          * Description    : Forces the TIM1 Channel4 output waveform to active or inactive 
   1544          *                  level.
   1545          * Input          : - TIM1_ForcedAction: specifies the forced Action to be set to
   1546          *                    the output waveform.
   1547          *                    This parameter can be one of the following values:
   1548          *                       - TIM1_ForcedAction_Active: Force active level on OC4REF
   1549          *                       - TIM1_ForcedAction_InActive: Force inactive level on
   1550          *                         OC4REF.
   1551          * Output         : None
   1552          * Return         : None
   1553          *******************************************************************************/
   1554          void TIM1_ForcedOC4Config(u16 TIM1_ForcedAction)
   1555          {
   1556            u32 tmpccmr2 = 0;
   1557          
   1558            /* Check the parameters */
   1559            assert(IS_TIM1_FORCED_ACTION(TIM1_ForcedAction));
   1560          
   1561            tmpccmr2 = TIM1->CCMR.Data[0];
   1562          
   1563            /* Reset the OCM Bits */
   1564            tmpccmr2 &= CCMR_OCM24_Mask;
   1565          
   1566            /* Configure The Forced output Mode */
   1567            tmpccmr2 |= (u16)((u16)TIM1_ForcedAction << 8);
   1568          
   1569            TIM1->CCMR.Data[1] = (u16)tmpccmr2;
   1570          }
   1571          
   1572          /*******************************************************************************
   1573          * Function Name  : TIM1_ARRPreloadConfig
   1574          * Description    : Enables or disables TIM1 peripheral Preload register on ARR.
   1575          * Input          : - Newstate: new state of the TIM1 peripheral Preload register
   1576          *                    This parameter can be: ENABLE or DISABLE.
   1577          * Output         : None
   1578          * Return         : None
   1579          *******************************************************************************/
   1580          void TIM1_ARRPreloadConfig(u32 Newstate)
   1581          {
   1582            /* Check the parameters */
   1583            assert(IS_FUNCTIONAL_STATE(Newstate));
   1584          
   1585            /* Set or Reset the ARPE Bit */
   1586            *(vu32 *) CR1_ARPE_BB = (u16)Newstate;
   1587          }
   1588          
   1589          /*******************************************************************************
   1590          * Function Name  : TIM1_SelectCOM
   1591          * Description    : Selects the TIM1 peripheral Commutation event.
   1592          * Input          : - Newstate: new state of the Commutation event.
   1593          *                    This parameter can be: ENABLE or DISABLE.
   1594          * Output         : None
   1595          * Return         : None
   1596          *******************************************************************************/
   1597          void TIM1_SelectCOM(u32 Newstate)
   1598          {
   1599            /* Check the parameters */
   1600            assert(IS_FUNCTIONAL_STATE(Newstate));
   1601          
   1602            /* Set or Reset the CCUS Bit */
   1603            *(vu32 *) CR2_CCUS_BB = (u16)Newstate;
   1604          }
   1605          
   1606          /*******************************************************************************
   1607          * Function Name  : TIM1_SelectCCDMA
   1608          * Description    : Selects the TIM1 peripheral Capture Compare DMA source.
   1609          * Input          : - Newstate: new state of the Capture Compare DMA source
   1610          *                    This parameter can be: ENABLE or DISABLE.
   1611          * Output         : None
   1612          * Return         : None
   1613          *******************************************************************************/
   1614          void TIM1_SelectCCDMA(u32 Newstate)
   1615          {
   1616            /* Check the parameters */
   1617            assert(IS_FUNCTIONAL_STATE(Newstate));
   1618          
   1619            /* Set or Reset the CCDS Bit */
   1620            *(vu32 *) CR2_CCDS_BB = (u16)Newstate;
   1621          }
   1622          
   1623          /*******************************************************************************
   1624          * Function Name  : TIM1_CCPreloadControl
   1625          * Description    : Sets or Resets the TIM1 peripheral Capture Compare Preload 
   1626          *                  Control bit.
   1627          * Input          : - Newstate: new state of the Capture Compare Preload Control bit
   1628          *                    This parameter can be: ENABLE or DISABLE.
   1629          * Output         : None
   1630          * Return         : None
   1631          *******************************************************************************/
   1632          void TIM1_CCPreloadControl(u32 Newstate)
   1633          {
   1634              /* Check the parameters */
   1635              assert(IS_FUNCTIONAL_STATE(Newstate));
   1636            
   1637              /* Set or Reset the CCPC Bit */
   1638              *(vu32 *) CR2_CCPC_BB = (u16)Newstate;
   1639          }
   1640          
   1641          /*******************************************************************************
   1642          * Function Name  : TIM1_OC1PreloadConfig
   1643          * Description    : Enables or disables the TIM1 peripheral Preload Register on CCR1.
   1644          * Input          : - TIM1_OCPreload: new state of the Capture Compare Preload
   1645          *                    register.
   1646          *                    This parameter can be one of the following values:
   1647          *                       - TIM1_OCPreload_Enable
   1648          *                       - TIM1_OCPreload_Disable
   1649          * Output         : None
   1650          * Return         : None
   1651          *******************************************************************************/
   1652          void TIM1_OC1PreloadConfig(u16 TIM1_OCPreload)
   1653          {
   1654            /* Check the parameters */
   1655            assert(IS_TIM1_OCPRELOAD_STATE(TIM1_OCPreload));
   1656          
   1657            /* Set or Reset the OC1PE Bit */
   1658            *(vu32 *) CCMR1_OC1PE_BB = (u16)TIM1_OCPreload;
   1659          }
   1660          
   1661          /*******************************************************************************
   1662          * Function Name  : TIM1_OC2PreloadConfig
   1663          * Description    : Enables or disables the TIM1 peripheral Preload Register on CCR2.
   1664          * Input          : - TIM1_OCPreload: new state of the Capture Compare Preload
   1665          *                    register.
   1666          *                    This parameter can be one of the following values:
   1667          *                       - TIM1_OCPreload_Enable
   1668          *                       - TIM1_OCPreload_Disable
   1669          * Output         : None
   1670          * Return         : None
   1671          *******************************************************************************/
   1672          void TIM1_OC2PreloadConfig(u16 TIM1_OCPreload)
   1673          {
   1674            /* Check the parameters */
   1675            assert(IS_TIM1_OCPRELOAD_STATE(TIM1_OCPreload));
   1676          
   1677            /* Set or Reset the OC2PE Bit */
   1678            *(vu32 *) CCMR1_OC2PE_BB = (u16)TIM1_OCPreload;
   1679          }
   1680          
   1681          /*******************************************************************************
   1682          * Function Name  : TIM1_OC3PreloadConfig
   1683          * Description    : Enables or disables the TIM1 peripheral Preload Register on CCR3.
   1684          * Input          : - TIM1_OCPreload: new state of the Capture Compare Preload
   1685          *                    register.
   1686          *                    This parameter can be one of the following values:
   1687          *                       - TIM1_OCPreload_Enable
   1688          *                       - TIM1_OCPreload_Disable
   1689          * Output         : None
   1690          * Return         : None
   1691          *******************************************************************************/
   1692          void TIM1_OC3PreloadConfig(u16 TIM1_OCPreload)
   1693          {
   1694            /* Check the parameters */
   1695            assert(IS_TIM1_OCPRELOAD_STATE(TIM1_OCPreload));
   1696          
   1697            /* Set or Reset the OC3PE Bit */
   1698            *(vu32 *) CCMR2_OC3PE_BB = (u16)TIM1_OCPreload;
   1699          }
   1700          
   1701          /*******************************************************************************
   1702          * Function Name  : TIM1_OC4PreloadConfig
   1703          * Description    : Enables or disables the TIM1 peripheral Preload Register on CCR4.
   1704          * Input          : - TIM1_OCPreload: new state of the Capture Compare Preload
   1705          *                    register.
   1706          *                    This parameter can be one of the following values:
   1707          *                       - TIM1_OCPreload_Enable
   1708          *                       - TIM1_OCPreload_Disable
   1709          * Output         : None
   1710          * Return         : None
   1711          *******************************************************************************/
   1712          void TIM1_OC4PreloadConfig(u16 TIM1_OCPreload)
   1713          {
   1714            /* Check the parameters */
   1715            assert(IS_TIM1_OCPRELOAD_STATE(TIM1_OCPreload));
   1716          
   1717            /* Set or Reset the OC4PE Bit */
   1718            *(vu32 *) CCMR2_OC4PE_BB = (u16)TIM1_OCPreload;
   1719          }
   1720          
   1721          /*******************************************************************************
   1722          * Function Name  : TIM1_OC1FastConfig
   1723          * Description    : Configures the TIM1 Capture Compare 1 Fast feature.
   1724          * Input          : - TIM1_OCFast: new state of the Output Compare Fast Enable bit.
   1725          *                    This parameter can be one of the following values:
   1726          *                       - TIM1_OCFast_Enable
   1727          *                       - TIM1_OCFast_Disable
   1728          * Output         : None
   1729          * Return         : None
   1730          *******************************************************************************/
   1731          void TIM1_OC1FastConfig(u16 TIM1_OCFast)
   1732          {
   1733            /* Check the parameters */
   1734            assert(IS_TIM1_OCFAST_STATE(TIM1_OCFast));
   1735          
   1736            /* Set or Reset the OC1FE Bit */
   1737            *(vu32 *) CCMR1_OC1FE_BB = (u16)TIM1_OCFast;
   1738          }
   1739          
   1740          /*******************************************************************************
   1741          * Function Name  : TIM1_OC2FastConfig
   1742          * Description    : Configures the TIM1 Capture Compare Fast feature.
   1743          * Input          : - TIM1_OCFast: new state of the Output Compare Fast Enable bit.
   1744          *                    This parameter can be one of the following values:
   1745          *                       - TIM1_OCFast_Enable
   1746          *                       - TIM1_OCFast_Disable
   1747          * Output         : None
   1748          * Return         : None
   1749          *******************************************************************************/
   1750          void TIM1_OC2FastConfig(u16 TIM1_OCFast)
   1751          {
   1752            /* Check the parameters */
   1753            assert(IS_TIM1_OCFAST_STATE(TIM1_OCFast));
   1754          
   1755            /* Set or Reset the OC2FE Bit */
   1756            *(vu32 *) CCMR1_OC2FE_BB = (u16)TIM1_OCFast;
   1757          }
   1758          
   1759          /*******************************************************************************
   1760          * Function Name  : TIM1_OC3FastConfig
   1761          * Description    : Configures the TIM1 Capture Compare Fast feature.
   1762          * Input          : - TIM1_OCFast: new state of the Output Compare Fast Enable bit.
   1763          *                    This parameter can be one of the following values:
   1764          *                       - TIM1_OCFast_Enable
   1765          *                       - TIM1_OCFast_Disable
   1766          * Output         : None
   1767          * Return         : None
   1768          *******************************************************************************/
   1769          void TIM1_OC3FastConfig(u16 TIM1_OCFast)
   1770          {
   1771            /* Check the parameters */
   1772            assert(IS_TIM1_OCFAST_STATE(TIM1_OCFast));
   1773          
   1774            /* Set or Reset the OC3FE Bit */
   1775            *(vu32 *) CCMR2_OC3FE_BB = (u16)TIM1_OCFast;
   1776          }
   1777          
   1778          /*******************************************************************************
   1779          * Function Name  : TIM1_OC4FastConfig
   1780          * Description    : Configures the TIM1 Capture Compare Fast feature.
   1781          * Input          : - TIM1_OCFast: new state of the Output Compare Fast Enable bit.
   1782          *                    This parameter can be one of the following values:
   1783          *                       - TIM1_OCFast_Enable
   1784          *                       - TIM1_OCFast_Disable
   1785          * Output         : None
   1786          * Return         : None
   1787          *******************************************************************************/
   1788          void TIM1_OC4FastConfig(u16 TIM1_OCFast)
   1789          {
   1790            /* Check the parameters */
   1791            assert(IS_TIM1_OCFAST_STATE(TIM1_OCFast));
   1792          
   1793            /* Set or Reset the OC4FE Bit */
   1794            *(vu32 *) CCMR2_OC4FE_BB = (u16)TIM1_OCFast;
   1795          }
   1796          
   1797          /*******************************************************************************
   1798          * Function Name  : TIM1_ClearOC1Ref
   1799          * Description    : Clears or safeguards the OCREF1 signal on an external event
   1800          *                  - TIM1_OCClear: new state of the Output Compare Clear Enable Bit.
   1801          *                    This parameter can be one of the following values:
   1802          *                       - TIM1_OCClear_Enable
   1803          *                       - TIM1_OCClear_Disable
   1804          * Output         : None
   1805          * Return         : None
   1806          *******************************************************************************/
   1807          void TIM1_ClearOC1Ref(u16 TIM1_OCClear)
   1808          {
   1809            /* Check the parameters */
   1810            assert(IS_TIM1_OCCLEAR_STATE(TIM1_OCClear));
   1811          
   1812            /* Set or Reset the OC1CE Bit */
   1813            *(vu32 *) CCMR1_OC1CE_BB = (u16)TIM1_OCClear;
   1814          }
   1815          
   1816          /*******************************************************************************
   1817          * Function Name  : TIM1_ClearOC2Ref
   1818          * Description    : Clears or safeguards the OCREF2 signal on an external event
   1819          *                  - TIM1_OCClear: new state of the Output Compare Clear Enable Bit.
   1820          *                    This parameter can be one of the following values:
   1821          *                       - TIM1_OCClear_Enable
   1822          *                       - TIM1_OCClear_Disable
   1823          * Output         : None
   1824          * Return         : None
   1825          *******************************************************************************/
   1826          void TIM1_ClearOC2Ref(u16 TIM1_OCClear)
   1827          {
   1828            /* Check the parameters */
   1829            assert(IS_TIM1_OCCLEAR_STATE(TIM1_OCClear));
   1830          
   1831            /* Set or Reset the OC2CE Bit */
   1832            *(vu32 *) CCMR1_OC2CE_BB = (u16)TIM1_OCClear;
   1833          }
   1834          
   1835          /*******************************************************************************
   1836          * Function Name  : TIM1_ClearOC3Ref
   1837          * Description    : Clears or safeguards the OCREF3 signal on an external event
   1838          *                  - TIM1_OCClear: new state of the Output Compare Clear Enable Bit.
   1839          *                    This parameter can be one of the following values:
   1840          *                       - TIM1_OCClear_Enable
   1841          *                       - TIM1_OCClear_Disable
   1842          * Output         : None
   1843          * Return         : None
   1844          *******************************************************************************/
   1845          void TIM1_ClearOC3Ref(u16 TIM1_OCClear)
   1846          {
   1847            /* Check the parameters */
   1848            assert(IS_TIM1_OCCLEAR_STATE(TIM1_OCClear));
   1849          
   1850            /* Set or Reset the OC3CE Bit */
   1851            *(vu32 *) CCMR2_OC3CE_BB = (u16)TIM1_OCClear;
   1852          }
   1853          
   1854          /*******************************************************************************
   1855          * Function Name  : TIM1_ClearOC4Ref
   1856          * Description    : Clears or safeguards the OCREF4 signal on an external event
   1857          *                  - TIM1_OCClear: new state of the Output Compare Clear Enable Bit.
   1858          *                    This parameter can be one of the following values:
   1859          *                       - TIM1_OCClear_Enable
   1860          *                       - TIM1_OCClear_Disable
   1861          * Output         : None
   1862          * Return         : None
   1863          *******************************************************************************/
   1864          void TIM1_ClearOC4Ref(u16 TIM1_OCClear)
   1865          {
   1866            /* Check the parameters */
   1867            assert(IS_TIM1_OCCLEAR_STATE(TIM1_OCClear));
   1868          
   1869            /* Set or Reset the OC4CE Bit */
   1870            *(vu32 *) CCMR2_OC4CE_BB = (u16)TIM1_OCClear;
   1871          }
   1872          
   1873          /*******************************************************************************
   1874          * Function Name  : TIM1_GenerateEvent
   1875          * Description    : Configures the TIM1 event to be generate by software.
   1876          * Input          : - TIM1_EventSource: specifies the event source.
   1877          *                    This parameter can be one or more of the following values:
   1878          *                       - TIM1_EventSource_Update: TIM1 update Event source
   1879          *                       - TIM1_EventSource_CC1: TIM1 Capture Compare 1 Event source
   1880          *                       - TIM1_EventSource_CC2: TIM1 Capture Compare 2 Event source
   1881          *                       - TIM1_EventSource_CC3: TIM1 Capture Compare 3 Event source
   1882          *                       - TIM1_EventSource_CC4: TIM1 Capture Compare 4 Event source
   1883          *                       - TIM1_EventSource_COM: TIM1 COM Event source
   1884          *                       - TIM1_EventSource_Trigger: TIM1 Trigger Event source
   1885          *                       - TIM1_EventSourceBreak: TIM1 Break Event source
   1886          * Output         : None
   1887          * Return         : None
   1888          *******************************************************************************/
   1889          void TIM1_GenerateEvent(u16 TIM1_EventSource)
   1890          {
   1891            /* Check the parameters */
   1892            assert(IS_TIM1_EVENT_SOURCE(TIM1_EventSource));
   1893          
   1894            /* Set the event sources */
   1895            TIM1->EGR.Data |= TIM1_EventSource;
   1896          }
   1897          
   1898          /*******************************************************************************
   1899          * Function Name  : TIM1_OC1PolarityConfig
   1900          * Description    : Configures the TIM1 Channel 1 polarity.
   1901          * Input          : - TIM1_OCPolarity: specifies the OC1 Polarity
   1902          *                    This parmeter can be one of the following values:
   1903          *                       - TIM1_OCPolarity_High: Output Compare active high
   1904          *                       - TIM1_OCPolarity_Low: Output Compare active low
   1905          * Output         : None
   1906          * Return         : None
   1907          *******************************************************************************/
   1908          void TIM1_OC1PolarityConfig(u16 TIM1_OCPolarity)
   1909          {
   1910            /* Check the parameters */
   1911            assert(IS_TIM1_OC_POLARITY(TIM1_OCPolarity));
   1912          
   1913            /* Set or Reset the CC1P Bit */
   1914            *(vu32 *) CCER_CC1P_BB = (u16)TIM1_OCPolarity;
   1915          }
   1916          
   1917          /*******************************************************************************
   1918          * Function Name  : TIM1_OC1NPolarityConfig
   1919          * Description    : Configures the TIM1 Channel 1N polarity.
   1920          * Input          : - TIM1_OCPolarity: specifies the OC1N Polarity
   1921          *                    This parmeter can be one of the following values:
   1922          *                       - TIM1_OCPolarity_High: Output Compare active high
   1923          *                       - TIM1_OCPolarity_Low: Output Compare active low
   1924          * Output         : None
   1925          * Return         : None
   1926          *******************************************************************************/
   1927          void TIM1_OC1NPolarityConfig(u16 TIM1_OCPolarity)
   1928          {
   1929            /* Check the parameters */
   1930            assert(IS_TIM1_OC_POLARITY(TIM1_OCPolarity));
   1931          
   1932            /* Set or Reset the CC3P Bit */
   1933            *(vu32 *) CCER_CC1NP_BB = (u16)TIM1_OCPolarity;
   1934          }
   1935          
   1936          /*******************************************************************************
   1937          * Function Name  : TIM1_OC2PolarityConfig
   1938          * Description    : Configures the TIM1 Channel 2 polarity.
   1939          * Input          : - TIM1_OCPolarity: specifies the OC2 Polarity
   1940          *                    This parmeter can be one of the following values:
   1941          *                       - TIM1_OCPolarity_High: Output Compare active high
   1942          *                       - TIM1_OCPolarity_Low: Output Compare active low
   1943          * Output         : None
   1944          * Return         : None
   1945          *******************************************************************************/
   1946          void TIM1_OC2PolarityConfig(u16 TIM1_OCPolarity)
   1947          {
   1948            /* Check the parameters */
   1949            assert(IS_TIM1_OC_POLARITY(TIM1_OCPolarity));
   1950          
   1951            /* Set or Reset the CC2P Bit */
   1952            *(vu32 *) CCER_CC2P_BB = (u16)TIM1_OCPolarity;
   1953          }
   1954          
   1955          /*******************************************************************************
   1956          * Function Name  : TIM1_OC2NPolarityConfig
   1957          * Description    : Configures the TIM1 Channel 2N polarity.
   1958          * Input          : - TIM1_OCPolarity: specifies the OC2N Polarity
   1959          *                    This parmeter can be one of the following values:
   1960          *                       - TIM1_OCPolarity_High: Output Compare active high
   1961          *                       - TIM1_OCPolarity_Low: Output Compare active low
   1962          * Output         : None
   1963          * Return         : None
   1964          *******************************************************************************/
   1965          void TIM1_OC2NPolarityConfig(u16 TIM1_OCPolarity)
   1966          {
   1967            /* Check the parameters */
   1968            assert(IS_TIM1_OC_POLARITY(TIM1_OCPolarity));
   1969          
   1970            /* Set or Reset the CC3P Bit */
   1971            *(vu32 *) CCER_CC2NP_BB = (u16)TIM1_OCPolarity;
   1972          }
   1973          
   1974          /*******************************************************************************
   1975          * Function Name  : TIM1_OC3PolarityConfig
   1976          * Description    : Configures the TIM1 Channel 3 polarity.
   1977          * Input          : - TIM1_OCPolarity: specifies the OC3 Polarity
   1978          *                    This parmeter can be one of the following values:
   1979          *                       - TIM1_OCPolarity_High: Output Compare active high
   1980          *                       - TIM1_OCPolarity_Low: Output Compare active low
   1981          * Output         : None
   1982          * Return         : None
   1983          *******************************************************************************/
   1984          void TIM1_OC3PolarityConfig(u16 TIM1_OCPolarity)
   1985          {
   1986            /* Check the parameters */
   1987            assert(IS_TIM1_OC_POLARITY(TIM1_OCPolarity));
   1988          
   1989            /* Set or Reset the CC3P Bit */
   1990            *(vu32 *) CCER_CC3P_BB = (u16)TIM1_OCPolarity;
   1991          }
   1992          
   1993          /*******************************************************************************
   1994          * Function Name  : TIM1_OC3NPolarityConfig
   1995          * Description    : Configures the TIM1 Channel 3N polarity.
   1996          * Input          : - TIM1_OCPolarity: specifies the OC3N Polarity
   1997          *                    This parmeter can be one of the following values:
   1998          *                       - TIM1_OCPolarity_High: Output Compare active high
   1999          *                       - TIM1_OCPolarity_Low: Output Compare active low
   2000          * Output         : None
   2001          * Return         : None
   2002          *******************************************************************************/
   2003          void TIM1_OC3NPolarityConfig(u16 TIM1_OCPolarity)
   2004          {
   2005            /* Check the parameters */
   2006            assert(IS_TIM1_OC_POLARITY(TIM1_OCPolarity));
   2007          
   2008            /* Set or Reset the CC3P Bit */
   2009            *(vu32 *) CCER_CC3NP_BB = (u16)TIM1_OCPolarity;
   2010          }
   2011          
   2012          /*******************************************************************************
   2013          * Function Name  : TIM1_OC4PolarityConfig
   2014          * Description    : Configures the TIM1 Channel 4 polarity.
   2015          * Input          : - TIM1_OCPolarity: specifies the OC4 Polarity
   2016          *                    This parmeter can be one of the following values:
   2017          *                       - TIM1_OCPolarity_High: Output Compare active high
   2018          *                       - TIM1_OCPolarity_Low: Output Compare active low
   2019          * Output         : None
   2020          * Return         : None
   2021          *******************************************************************************/
   2022          void TIM1_OC4PolarityConfig(u16 TIM1_OCPolarity)
   2023          {
   2024            /* Check the parameters */
   2025            assert(IS_TIM1_OC_POLARITY(TIM1_OCPolarity));
   2026          
   2027            /* Set or Reset the CC4P Bit */
   2028            *(vu32 *) CCER_CC4P_BB = (u16)TIM1_OCPolarity;
   2029          }
   2030          
   2031          /*******************************************************************************
   2032          * Function Name  : TIM1_CCxCmd
   2033          * Description    : Enables or disables the TIM1 Capture Compare Channel x.
   2034          * Input          : - TIM1_Channel: specifies the TIM1 Channel
   2035          *                    This parmeter can be one of the following values:
   2036          *                       - TIM1_Channel1: TIM1 Channel1
   2037          *                       - TIM1_Channel2: TIM1 Channel2
   2038          *                       - TIM1_Channel3: TIM1 Channel3
   2039          *                       - TIM1_Channel4: TIM1 Channel4
   2040          *                 - Newstate: specifies the TIM1 Channel CCxE bit new state.
   2041          *                   This parameter can be: ENABLE or DISABLE. 
   2042          * Output         : None
   2043          * Return         : None
   2044          *******************************************************************************/
   2045          void TIM1_CCxCmd(u16 TIM1_Channel, u32 Newstate)
   2046          {
   2047            /* Check the parameters */
   2048            assert(IS_TIM1_CHANNEL(TIM1_Channel));
   2049            assert(IS_FUNCTIONAL_STATE(Newstate));
   2050          
   2051            if(TIM1_Channel == TIM1_Channel_1)
   2052            {
   2053              /* Set or Reset the CC1E Bit */
   2054              *(vu32 *) CCER_CC1E_BB = (u16)Newstate;  
   2055            }
   2056            else if(TIM1_Channel == TIM1_Channel_2)
   2057            {
   2058              /* Set or Reset the CC2E Bit */
   2059              *(vu32 *) CCER_CC2E_BB = (u16)Newstate;
   2060            }
   2061            else if(TIM1_Channel == TIM1_Channel_3)
   2062            {
   2063              /* Set or Reset the CC3E Bit */
   2064              *(vu32 *) CCER_CC3E_BB = (u16)Newstate;
   2065            }
   2066            else
   2067            {
   2068              /* Set or Reset the CC4E Bit */
   2069              *(vu32 *) CCER_CC4E_BB = (u16)Newstate;
   2070            }
   2071          }
   2072          
   2073          /*******************************************************************************
   2074          * Function Name  : TIM1_CCxNCmd
   2075          * Description    : Enables or disables the TIM1 Capture Compare Channel xN.
   2076          * Input          : - TIM1_Channel: specifies the TIM1 Channel
   2077          *                    This parmeter can be one of the following values:
   2078          *                       - TIM1_Channel1: TIM1 Channel1
   2079          *                       - TIM1_Channel2: TIM1 Channel2
   2080          *                       - TIM1_Channel3: TIM1 Channel3
   2081          *                 - Newstate: specifies the TIM1 Channel CCxNE bit new state.
   2082          *                   This parameter can be: ENABLE or DISABLE. 
   2083          * Output         : None
   2084          * Return         : None
   2085          *******************************************************************************/
   2086          void TIM1_CCxNCmd(u16 TIM1_Channel, u32 Newstate)
   2087          {
   2088              /* Check the parameters */
   2089              assert(IS_TIM1_COMPLEMENTARY_CHANNEL(TIM1_Channel));
   2090              assert(IS_FUNCTIONAL_STATE(Newstate));
   2091          
   2092              if(TIM1_Channel == TIM1_Channel_1)
   2093              {
   2094                  /* Set or Reset the CC1NE Bit */
   2095                  *(vu32 *) CCER_CC1NE_BB = (u16)Newstate;  
   2096              }
   2097              else if(TIM1_Channel == TIM1_Channel_2)
   2098              {
   2099                  /* Set or Reset the CC2NE Bit */
   2100                  *(vu32 *) CCER_CC2NE_BB = (u16)Newstate;
   2101              }
   2102              else 
   2103              {
   2104                  /* Set or Reset the CC3NE Bit */
   2105                  *(vu32 *) CCER_CC3NE_BB = (u16)Newstate;
   2106              }
   2107          }
   2108          
   2109          /*******************************************************************************
   2110          * Function Name  : TIM1_SelectOCxM
   2111          * Description    : Selects the TIM1 Ouput Compare Mode.
   2112          *                  This function disables the selected channel before changing 
   2113          *                  the Ouput Compare Mode. User has to enable this channel using
   2114          *                  TIM1_CCxCmd and TIM1_CCxNCmd functions.
   2115          * Input          : - TIM1_Channel: specifies the TIM1 Channel
   2116          *                    This parmeter can be one of the following values:
   2117          *                       - TIM1_Channel1: TIM1 Channel1
   2118          *                       - TIM1_Channel2: TIM1 Channel2
   2119          *                       - TIM1_Channel3: TIM1 Channel3
   2120          *                       - TIM1_Channel4: TIM1 Channel4
   2121          *                  - TIM1_OCMode: specifies the TIM1 Output Compare Mode.
   2122          *                    This paramter can be one of the following values:
   2123          *                       - TIM1_OCMode_Timing
   2124          *                       - TIM1_OCMode_Active
   2125          *                       - TIM1_OCMode_Toggle
   2126          *                       - TIM1_OCMode_PWM1
   2127          *                       - TIM1_OCMode_PWM2
   2128          *                       - TIM1_ForcedAction_Active
   2129          *                       - TIM1_ForcedAction_InActive
   2130          * Output         : None
   2131          * Return         : None
   2132          *******************************************************************************/
   2133          void TIM1_SelectOCxM(u16 TIM1_Channel, u16 TIM1_OCMode)
   2134          {
   2135            /* Check the parameters */
   2136            assert(IS_TIM1_CHANNEL(TIM1_Channel));
   2137            assert(IS_TIM1_OCM(TIM1_OCMode));
   2138          
   2139            if(TIM1_Channel == TIM1_Channel_1)
   2140            {
   2141              /* Disable the Channel 1: Reset the CCE Bit */
   2142              *(vu32 *) CCER_CC1E_BB = CCER_CCE_Reset;
   2143          
   2144              /* Reset the Output Compare Bits */
   2145              TIM1->CCMR.Data[0] &= OC13Mode_Mask;
   2146          
   2147              /* Set the Ouput Compare Mode */
   2148              TIM1->CCMR.Data[0] |= TIM1_OCMode;
   2149            }
   2150            else if(TIM1_Channel == TIM1_Channel_2)
   2151            {
   2152              /* Disable the Channel 2: Reset the CCE Bit */
   2153              *(vu32 *) CCER_CC2E_BB = CCER_CCE_Reset;
   2154          
   2155              /* Reset the Output Compare Bits */
   2156              TIM1->CCMR.Data[0] &= OC24Mode_Mask;
   2157          
   2158              /* Set the Ouput Compare Mode */
   2159              TIM1->CCMR.Data[0] |= (u16)((u16)TIM1_OCMode << 8);
   2160            }
   2161            else if(TIM1_Channel == TIM1_Channel_3)
   2162            {
   2163              /* Disable the Channel 3: Reset the CCE Bit */
   2164              *(vu32 *) CCER_CC3E_BB = CCER_CCE_Reset;
   2165          
   2166              /* Reset the Output Compare Bits */
   2167              TIM1->CCMR.Data[1] &= OC13Mode_Mask;
   2168          
   2169              /* Set the Ouput Compare Mode */
   2170              TIM1->CCMR.Data[1] |= TIM1_OCMode;
   2171            }
   2172            else
   2173            {
   2174              /* Disable the Channel 4: Reset the CCE Bit */
   2175              *(vu32 *) CCER_CC4E_BB = CCER_CCE_Reset;
   2176          
   2177              /* Reset the Output Compare Bits */
   2178              TIM1->CCMR.Data[1] &= OC24Mode_Mask;
   2179          
   2180              /* Set the Ouput Compare Mode */
   2181              TIM1->CCMR.Data[1] |= (u16)((u16)TIM1_OCMode << 8);
   2182            }
   2183          }
   2184          
   2185          /*******************************************************************************
   2186          * Function Name  : TIM1_SetCounter
   2187          * Description    : Sets the TIM1 Counter Register value
   2188          * Input          : - Counter: specifies the Counter register new value.
   2189          * Output         : None
   2190          * Return         : None
   2191          *******************************************************************************/
   2192          void TIM1_SetCounter(u16 Counter)
   2193          {
   2194            /* Set the Counter Register value */
   2195            TIM1->CNT = Counter;
   2196          }
   2197          
   2198          /*******************************************************************************
   2199          * Function Name  : TIM1_SetAutoreload
   2200          * Description    : Sets the TIM1 Autoreload Register value.
   2201          * Input          : - Autoreload: specifies the Autoreload register new value.
   2202          * Output         : None
   2203          * Return         : None
   2204          *******************************************************************************/
   2205          void TIM1_SetAutoreload(u16 Autoreload)
   2206          {
   2207            /* Set the Autoreload Register value */
   2208            TIM1->ARR = Autoreload;
   2209          }
   2210          
   2211          /*******************************************************************************
   2212          * Function Name  : TIM1_SetCompare1
   2213          * Description    : Sets the TIM1 Capture Compare1 Register value.
   2214          * Input          : - Compare1: specifies the Capture Compare1 register new value.
   2215          * Output         : None
   2216          * Return         : None
   2217          *******************************************************************************/
   2218          void TIM1_SetCompare1(u16 Compare1)
   2219          {
   2220            /* Set the Capture Compare1 Register value */
   2221            TIM1->CCR1 = Compare1;
   2222          }
   2223          
   2224          /*******************************************************************************
   2225          * Function Name  : TIM1_SetCompare2
   2226          * Description    : Sets the TIM1 Capture Compare2 Register value.
   2227          * Input          : - Compare2: specifies the Capture Compare2 register new value.
   2228          * Output         : None
   2229          * Return         : None
   2230          *******************************************************************************/
   2231          void TIM1_SetCompare2(u16 Compare2)
   2232          {
   2233            /* Set the Capture Compare2 Register value */
   2234            TIM1->CCR2 = Compare2;
   2235          }
   2236          
   2237          /*******************************************************************************
   2238          * Function Name  : TIM1_SetCompare3
   2239          * Description    : Sets the TIM1 Capture Compare3 Register value.
   2240          * Input          : - Compare3: specifies the Capture Compare3 register new value.
   2241          * Output         : None
   2242          * Return         : None
   2243          *******************************************************************************/
   2244          void TIM1_SetCompare3(u16 Compare3)
   2245          {
   2246            /* Set the Capture Compare3 Register value */
   2247            TIM1->CCR3 = Compare3;
   2248          }
   2249          
   2250          /*******************************************************************************
   2251          * Function Name  : TIM1_SetCompare4
   2252          * Description    : Sets the TIM1 Capture Compare4 Register value.
   2253          * Input          : - Compare4: specifies the Capture Compare4 register new value.
   2254          * Output         : None
   2255          * Return         : None
   2256          *******************************************************************************/
   2257          void TIM1_SetCompare4(u16 Compare4)
   2258          {
   2259            /* Set the Capture Compare4 Register value */
   2260            TIM1->CCR4 = Compare4;
   2261          }
   2262          
   2263          /*******************************************************************************
   2264          * Function Name  : TIM1_SetIC1Prescaler
   2265          * Description    : Sets the TIM1 Input Capture 1 prescaler.
   2266          * Input          : - TIM1_IC1Prescaler: specifies the Input Capture prescaler
   2267          *                    new value.
   2268          *                    This parameter can be one of the following values:
   2269          *                       - TIM1_ICPSC_DIV1: no prescaler
   2270          *                       - TIM1_ICPSC_DIV2: capture is done once every 2 events
   2271          *                       - TIM1_ICPSC_DIV4: capture is done once every 4 events
   2272          *                       - TIM1_ICPSC_DIV8: capture is done once every 8 events
   2273          * Output         : None
   2274          * Return         : None
   2275          *******************************************************************************/
   2276          void TIM1_SetIC1Prescaler(u16 TIM1_IC1Prescaler)
   2277          {
   2278            u32 tmpccmr1 = 0;
   2279            
   2280            /* Check the parameters */
   2281            assert(IS_TIM1_IC_PRESCALER(TIM1_IC1Prescaler));
   2282          
   2283            tmpccmr1 = TIM1->CCMR.Data[0];
   2284          
   2285            /* Reset the IC1PSC Bits */
   2286            tmpccmr1 &= CCMR_IC13PSC_Mask;
   2287          
   2288            /* Set the IC1PSC value */
   2289            tmpccmr1 |= TIM1_IC1Prescaler;
   2290          
   2291            TIM1->CCMR.Data[0] = (u16)tmpccmr1;
   2292          }
   2293          
   2294          /*******************************************************************************
   2295          * Function Name  : TIM1_SetIC2Prescaler
   2296          * Description    : Sets the TIM1 Input Capture 2 prescaler.
   2297          * Input          : - TIM1_IC2Prescaler: specifies the Input Capture prescaler
   2298          *                    new value.
   2299          *                    This parameter can be one of the following values:
   2300          *                       - TIM1_ICPSC_DIV1: no prescaler
   2301          *                       - TIM1_ICPSC_DIV2: capture is done once every 2 events
   2302          *                       - TIM1_ICPSC_DIV4: capture is done once every 4 events
   2303          *                       - TIM1_ICPSC_DIV8: capture is done once every 8 events
   2304          * Output         : None
   2305          * Return         : None
   2306          *******************************************************************************/
   2307          void TIM1_SetIC2Prescaler(u16 TIM1_IC2Prescaler)
   2308          {
   2309            u32 tmpccmr1 = 0;
   2310          
   2311            /* Check the parameters */
   2312            assert(IS_TIM1_IC_PRESCALER(TIM1_IC2Prescaler));
   2313          
   2314            tmpccmr1 = TIM1->CCMR.Data[0];
   2315          
   2316            /* Reset the IC2PSC Bits */
   2317            tmpccmr1 &= CCMR_IC24PSC_Mask;
   2318          
   2319            /* Set the IC2PSC value */
   2320            tmpccmr1 |= (u16)((u16)TIM1_IC2Prescaler << 8);
   2321          
   2322            TIM1->CCMR.Data[0] = (u16)tmpccmr1;
   2323          }
   2324          
   2325          /*******************************************************************************
   2326          * Function Name  : TIM1_SetIC3Prescaler
   2327          * Description    : Sets the TIM1 Input Capture 3 prescaler.
   2328          * Input          : - TIM1_IC3Prescaler: specifies the Input Capture prescaler
   2329          *                    new value.
   2330          *                    This parameter can be one of the following values:
   2331          *                       - TIM1_ICPSC_DIV1: no prescaler
   2332          *                       - TIM1_ICPSC_DIV2: capture is done once every 2 events
   2333          *                       - TIM1_ICPSC_DIV4: capture is done once every 4 events
   2334          *                       - TIM1_ICPSC_DIV8: capture is done once every 8 events
   2335          * Output         : None
   2336          * Return         : None
   2337          *******************************************************************************/
   2338          void TIM1_SetIC3Prescaler(u16 TIM1_IC3Prescaler)
   2339          {
   2340            u32 tmpccmr2 = 0;
   2341          
   2342            /* Check the parameters */
   2343            assert(IS_TIM1_IC_PRESCALER(TIM1_IC3Prescaler));
   2344          
   2345            tmpccmr2 = TIM1->CCMR.Data[1];
   2346          
   2347            /* Reset the IC3PSC Bits */
   2348            tmpccmr2 &= CCMR_IC13PSC_Mask;
   2349          
   2350            /* Set the IC3PSC value */
   2351            tmpccmr2 |= TIM1_IC3Prescaler;
   2352          
   2353            TIM1->CCMR.Data[1] = (u16)tmpccmr2;
   2354          }
   2355          
   2356          /*******************************************************************************
   2357          * Function Name  : TIM1_SetIC4Prescaler
   2358          * Description    : Sets the TIM1 Input Capture 4 prescaler.
   2359          * Input          : - TIM1_IC4Prescaler: specifies the Input Capture prescaler
   2360          *                    new value.
   2361          *                    This parameter can be one of the following values:
   2362          *                       - TIM1_ICPSC_DIV1: no prescaler
   2363          *                       - TIM1_ICPSC_DIV2: capture is done once every 2 events
   2364          *                       - TIM1_ICPSC_DIV4: capture is done once every 4 events
   2365          *                       - TIM1_ICPSC_DIV8: capture is done once every 8 events
   2366          * Output         : None
   2367          * Return         : None
   2368          *******************************************************************************/
   2369          void TIM1_SetIC4Prescaler(u16 TIM1_IC4Prescaler)
   2370          {
   2371            u32 tmpccmr2 = 0;
   2372          
   2373            /* Check the parameters */
   2374            assert(IS_TIM1_IC_PRESCALER(TIM1_IC4Prescaler));
   2375          
   2376            tmpccmr2 = TIM1->CCMR.Data[1];
   2377          
   2378            /* Reset the IC4PSC Bits */
   2379            tmpccmr2 &= CCMR_IC24PSC_Mask;
   2380          
   2381            /* Set the IC4PSC value */
   2382            tmpccmr2 |= (u16)((u16)TIM1_IC4Prescaler << 8);
   2383          
   2384            TIM1->CCMR.Data[1] = (u16)tmpccmr2;
   2385          }
   2386          
   2387          /*******************************************************************************
   2388          * Function Name  : TIM1_SetClockDivision
   2389          * Description    : Sets the TIM1 Clock Division value.
   2390          * Input          : - TIM1_CKD: specifies the clock division value.
   2391          *                    This parameter can be one of the following value:
   2392          *                       - TIM1_CKD_DIV1: TDTS = Tck_tim
   2393          *                       - TIM1_CKD_DIV2: TDTS = 2*Tck_tim
   2394          *                       - TIM1_CKD_DIV4: TDTS = 4*Tck_tim
   2395          * Output         : None
   2396          * Return         : None
   2397          *******************************************************************************/
   2398          void TIM1_SetClockDivision(u16 TIM1_CKD)
   2399          {
   2400            u32 tmpcr1 = 0;
   2401          
   2402            tmpcr1 = TIM1->CR1.Data;
   2403          
   2404            /* Reset the CKD Bits */
   2405            tmpcr1 &= CR1_CKD_Mask;
   2406          
   2407            /* Set the CKD value */
   2408            tmpcr1 |= TIM1_CKD;
   2409          
   2410            TIM1->CR1.Data = (u16)tmpcr1;
   2411          }
   2412          
   2413          /*******************************************************************************
   2414          * Function Name  : TIM1_GetCapture1
   2415          * Description    : Gets the TIM1 Input Capture 1 value.
   2416          * Input          : None
   2417          * Output         : None
   2418          * Return         : Capture Compare 1 Register value.
   2419          *******************************************************************************/
   2420          u16 TIM1_GetCapture1(void)
   2421          {
   2422            /* Get the Capture 1 Register value */
   2423            return TIM1->CCR1;
   2424          }
   2425          
   2426          /*******************************************************************************
   2427          * Function Name  : TIM1_GetCapture2
   2428          * Description    : Gets the TIM1 Input Capture 2 value.
   2429          * Input          : None
   2430          * Output         : None
   2431          * Return         : Capture Compare 2 Register value.
   2432          *******************************************************************************/
   2433          u16 TIM1_GetCapture2(void)
   2434          {
   2435            /* Get the Capture 2 Register value */
   2436            return TIM1->CCR2;
   2437          }
   2438          
   2439          /*******************************************************************************
   2440          * Function Name  : TIM1_GetCapture3
   2441          * Description    : Gets the TIM1 Input Capture 3 value.
   2442          * Input          : None
   2443          * Output         : None
   2444          * Return         : Capture Compare 3 Register value.
   2445          *******************************************************************************/
   2446          u16 TIM1_GetCapture3(void)
   2447          {
   2448            /* Get the Capture 3 Register value */
   2449            return TIM1->CCR3;
   2450          }
   2451          
   2452          /*******************************************************************************
   2453          * Function Name  : TIM1_GetCapture4
   2454          * Description    : Gets the TIM1 Input Capture 4 value.
   2455          * Input          : None
   2456          * Output         : None
   2457          * Return         : Capture Compare 4 Register value.
   2458          *******************************************************************************/
   2459          u16 TIM1_GetCapture4(void)
   2460          {
   2461            /* Get the Capture 4 Register value */
   2462            return TIM1->CCR4;
   2463          }
   2464          
   2465          /*******************************************************************************
   2466          * Function Name  : TIM1_GetCounter
   2467          * Description    : Gets the TIM1 Counter value.
   2468          * Input          : None
   2469          * Output         : None
   2470          * Return         : Counter Register value.
   2471          *******************************************************************************/
   2472          u16 TIM1_GetCounter(void)
   2473          {
   2474            /* Get the Counter Register value */
   2475            return TIM1->CNT;
   2476          }
   2477          
   2478          /*******************************************************************************
   2479          * Function Name  : TIM1_GetPrescaler
   2480          * Description    : Gets the TIM1 Prescaler value.
   2481          * Input          : None
   2482          * Output         : None
   2483          * Return         : Prescaler Register value.
   2484          *******************************************************************************/
   2485          u16 TIM1_GetPrescaler(void)
   2486          {
   2487            /* Get the Prescaler Register value */
   2488            return TIM1->PSC;
   2489          }
   2490          
   2491          /*******************************************************************************
   2492          * Function Name  : TIM1_GetFlagStatus
   2493          * Description    : Checks whether the specified TIM1 flag is set or not.
   2494          * Input          : - TIM1_FLAG: specifies the flag to check.
   2495          *                    This parameter can be one of the following values:
   2496          *                       - TIM1_FLAG_Update: TIM1 update Flag
   2497          *                       - TIM1_FLAG_CC1: TIM1 Capture Compare 1 Flag
   2498          *                       - TIM1_FLAG_CC2: TIM1 Capture Compare 2 Flag
   2499          *                       - TIM1_FLAG_CC3: TIM1 Capture Compare 3 Flag
   2500          *                       - TIM1_FLAG_CC4: TIM1 Capture Compare 4 Flag
   2501          *                       - TIM1_FLAG_COM: TIM1 Commutation Flag
   2502          *                       - TIM1_FLAG_Trigger: TIM1 Trigger Flag
   2503          *                       - TIM1_FLAG_Break: TIM1 Break Flag
   2504          *                       - TIM1_FLAG_CC1OF: TIM1 Capture Compare 1 overcapture Flag
   2505          *                       - TIM1_FLAG_CC2OF: TIM1 Capture Compare 2 overcapture Flag
   2506          *                       - TIM1_FLAG_CC3OF: TIM1 Capture Compare 3 overcapture Flag
   2507          *                       - TIM1_FLAG_CC4OF: TIM1 Capture Compare 4 overcapture Flag
   2508          * Output         : None
   2509          * Return         : The new state of TIM1_FLAG (SET or RESET).
   2510          *******************************************************************************/
   2511          FlagStatus TIM1_GetFlagStatus(u16 TIM1_FLAG)
   2512          {
   2513            FlagStatus bitstatus = RESET;
   2514          
   2515            /* Check the parameters */
   2516            assert(IS_TIM1_GET_FLAG(TIM1_FLAG));
   2517          
   2518            if ((TIM1->SR.Data & TIM1_FLAG) != (u16)RESET )
   2519            {
   2520              bitstatus = SET;
   2521            }
   2522            else
   2523            {
   2524              bitstatus = RESET;
   2525            }
   2526            return bitstatus;
   2527          }
   2528          
   2529          /*******************************************************************************
   2530          * Function Name  : TIM1_ClearFlag
   2531          * Description    : Clears the TIM1s pending flags.
   2532          * Input          : - TIM1_FLAG: specifies the flag to clear.
   2533          *                    This parameter can be any combination of the following values:
   2534          *                       - TIM1_FLAG_Update: TIM1 update Flag
   2535          *                       - TIM1_FLAG_CC1: TIM1 Capture Compare 1 Flag
   2536          *                       - TIM1_FLAG_CC2: TIM1 Capture Compare 2 Flag
   2537          *                       - TIM1_FLAG_CC3: TIM1 Capture Compare 3 Flag
   2538          *                       - TIM1_FLAG_CC4: TIM1 Capture Compare 4 Flag
   2539          *                       - TIM1_FLAG_COM: TIM1 Commutation Flag
   2540          *                       - TIM1_FLAG_Trigger: TIM1 Trigger Flag
   2541          *                       - TIM1_FLAG_Break: TIM1 Break Flag
   2542          *                       - TIM1_FLAG_CC1OF: TIM1 Capture Compare 1 overcapture Flag
   2543          *                       - TIM1_FLAG_CC2OF: TIM1 Capture Compare 2 overcapture Flag
   2544          *                       - TIM1_FLAG_CC3OF: TIM1 Capture Compare 3 overcapture Flag
   2545          *                       - TIM1_FLAG_CC4OF: TIM1 Capture Compare 4 overcapture Flag
   2546          * Output         : None
   2547          * Return         : None
   2548          *******************************************************************************/
   2549          void TIM1_ClearFlag(u16 TIM1_FLAG)
   2550          {
   2551            /* Check the parameters */
   2552            assert(IS_TIM1_CLEAR_FLAG(TIM1_FLAG));
   2553          
   2554            /* Clear the flags */
   2555            TIM1->SR.Data &= (u16)~TIM1_FLAG;
   2556          }
   2557          
   2558          /*******************************************************************************
   2559          * Function Name  : TIM1_GetITStatus
   2560          * Description    : Checks whether the TIM1 interrupt has occurred or not.
   2561          * Input          : - TIM1_IT: specifies the TIM1 interrupt source to check.
   2562          *                    This parameter can be one of the following values:
   2563          *                       - TIM1_IT_Update: TIM1 update Interrupt source
   2564          *                       - TIM1_IT_CC1: TIM1 Capture Compare 1 Interrupt source
   2565          *                       - TIM1_IT_CC2: TIM1 Capture Compare 2 Interrupt source
   2566          *                       - TIM1_IT_CC3: TIM1 Capture Compare 3 Interrupt source
   2567          *                       - TIM1_IT_CC4: TIM1 Capture Compare 4 Interrupt source
   2568          *                       - TIM1_IT_COM: TIM1 Commutation Interrupt
   2569          *                         source
   2570          *                       - TIM1_IT_Trigger: TIM1 Trigger Interrupt source
   2571          *                       - TIM1_IT_Break: TIM1 Break Interrupt source
   2572          * Output         : None
   2573          * Return         : The new state of the TIM1_IT(SET or RESET).
   2574          *******************************************************************************/
   2575          ITStatus TIM1_GetITStatus(u16 TIM1_IT)
   2576          {
   2577            ITStatus bitstatus = RESET;
   2578            
   2579            u16 TIM1_itStatus = 0x0, TIM1_itEnable = 0x0;
   2580          
   2581            /* Check the parameters */
   2582            assert(IS_TIM1_GET_IT(TIM1_IT));
   2583            
   2584            TIM1_itStatus = TIM1->SR.Data & TIM1_IT;
   2585            
   2586            TIM1_itEnable = TIM1->DIER.Data & TIM1_IT;
   2587          
   2588            if ((TIM1_itStatus != (u16)RESET ) && (TIM1_itEnable != (u16)RESET ))
   2589            {
   2590              bitstatus = SET;
   2591            }
   2592            else
   2593            {
   2594              bitstatus = RESET;
   2595            }
   2596            return bitstatus;
   2597          }
   2598          
   2599          /*******************************************************************************
   2600          * Function Name  : TIM1_ClearITPendingBit
   2601          * Description    : Clears the TIM1's interrupt pending bits.
   2602          * Input          : - TIM1_IT: specifies the pending bit to clear.
   2603          *                    This parameter can be any combination of the following values:
   2604          *                       - TIM1_IT_Update: TIM1 update Interrupt source
   2605          *                       - TIM1_IT_CC1: TIM1 Capture Compare 1 Interrupt source
   2606          *                       - TIM1_IT_CC2: TIM1 Capture Compare 2 Interrupt source
   2607          *                       - TIM1_IT_CC3: TIM1 Capture Compare 3 Interrupt source
   2608          *                       - TIM1_IT_CC4: TIM1 Capture Compare 4 Interrupt source
   2609          *                       - TIM1_IT_COM: TIM1 Commutation Interrupt
   2610          *                         source
   2611          *                       - TIM1_IT_Trigger: TIM1 Trigger Interrupt source
   2612          *                       - TIM1_IT_Break: TIM1 Break Interrupt source
   2613          * Output         : None
   2614          * Return         : None
   2615          *******************************************************************************/
   2616          void TIM1_ClearITPendingBit(u16 TIM1_IT)
   2617          {
   2618            /* Check the parameters */
   2619            assert(IS_TIM1_IT(TIM1_IT));
   2620          
   2621            /* Clear the IT pending Bit */
   2622            TIM1->SR.Data &= (u16)~TIM1_IT;
   2623          }
   2624          
   2625          /*******************************************************************************
   2626          * Function Name  : TI1_Config
   2627          * Description    : Configure the TI1 as Input.
   2628          * Input          : - TIM1_ICPolarity : The Input Polarity.
   2629          *                    This parameter can be one of the following values:
   2630          *                       - TIM1_ICPolarity_Rising
   2631          *                       - TIM1_ICPolarity_Falling
   2632          *                  - TIM1_ICSelection: specifies the input to be used.
   2633          *                    This parameter can be one of the following values:
   2634          *                       - TIM1_ICSelection_DirectTI: TIM1 Input 1 is selected to
   2635          *                         be connected to IC1.
   2636          *                       - TIM1_ICSelection_IndirectTI: TIM1 Input 1 is selected to
   2637          *                         be connected to IC2.
   2638          *                       - TIM1_ICSelection_TRGI:TIM1 Input 1 is selected to be
   2639          *                         connected to TRGI.
   2640          *                  - TIM1_ICFilter: Specifies the Input Capture Filter.
   2641          *                    This parameter must be a value between 0x00 and 0x0F.
   2642          * Output         : None
   2643          * Return         : None
   2644          *******************************************************************************/
   2645          static void TI1_Config(u16 TIM1_ICPolarity, u16 TIM1_ICSelection,
   2646                                 u8 TIM1_ICFilter)
   2647          {
   2648            u32 tmpccmr1 = 0;
   2649          
   2650            tmpccmr1 = TIM1->CCMR.Data[0];
   2651          
   2652            /* Disable the Channel 1: Reset the CCE Bit */
   2653            *(vu32 *) CCER_CC1E_BB = CCER_CCE_Reset;
   2654          
   2655            /* Select the Input and set the filter */
   2656            tmpccmr1 &= CCMR_CC13S_Mask & CCMR_IC13F_Mask;
   2657            tmpccmr1 |= (u16)TIM1_ICSelection | (u16)((u16)TIM1_ICFilter << 4);
   2658          
   2659            TIM1->CCMR.Data[0] = (u16)tmpccmr1;
   2660          
   2661            /* Select the Polarity */
   2662            *(vu32 *) CCER_CC1P_BB = TIM1_ICPolarity;
   2663          
   2664            /* Set the CCE Bit */
   2665            *(vu32 *) CCER_CC1E_BB = CCER_CCE_Set;
   2666          }
   2667          
   2668          /*******************************************************************************
   2669          * Function Name  : TI2_Config
   2670          * Description    : Configure the TI2 as Input.
   2671          * Input          : - TIM1_ICPolarity : The Input Polarity.
   2672          *                    This parameter can be one of the following values:
   2673          *                       - TIM1_ICPolarity_Rising
   2674          *                       - TIM1_ICPolarity_Falling
   2675          *                  - TIM1_ICSelection: specifies the input to be used.
   2676          *                    This parameter can be one of the following values:
   2677          *                       - TIM1_ICSelection_DirectTI: TIM1 Input 2 is selected to
   2678          *                         be connected to IC2.
   2679          *                       - TIM1_ICSelection_IndirectTI: TIM1 Input 2 is selected to
   2680          *                         be connected to IC1.
   2681          *                       - TIM1_ICSelection_TRGI: TIM1 Input 2 is selected to be
   2682          *                         connected to TRGI.
   2683          *                  - TIM1_ICFilter: Specifies the Input Capture Filter.
   2684          *                    This parameter must be a value between 0x00 and 0x0F.
   2685          * Output         : None
   2686          * Return         : None
   2687          *******************************************************************************/
   2688          static void TI2_Config(u16 TIM1_ICPolarity, u16 TIM1_ICSelection,
   2689                                 u8 TIM1_ICFilter)
   2690          {
   2691            u32 tmpccmr1 = 0;
   2692          
   2693            tmpccmr1 = TIM1->CCMR.Data[0];
   2694          
   2695            /* Disable the Channel 2: Reset the CCE Bit */
   2696            *(vu32 *) CCER_CC2E_BB = CCER_CCE_Reset;
   2697          
   2698            /* Select the Input and set the filter */
   2699            tmpccmr1 &= CCMR_CC24S_Mask & CCMR_IC24F_Mask;
   2700            tmpccmr1 |= (u16)((u16)TIM1_ICSelection << 8) | (u16)((u16)TIM1_ICFilter <<12);
   2701          
   2702            TIM1->CCMR.Data[0] = (u16)tmpccmr1;
   2703          
   2704            /* Select the Polarity */
   2705            *(vu32 *) CCER_CC2P_BB = TIM1_ICPolarity;
   2706          
   2707            /* Set the CCE Bit */
   2708            *(vu32 *) CCER_CC2E_BB = CCER_CCE_Set;
   2709          
   2710          }
   2711          
   2712          /*******************************************************************************
   2713          * Function Name  : TI3_Config
   2714          * Description    : Configure the TI3 as Input.
   2715          * Input          : - TIM1_ICPolarity : The Input Polarity.
   2716          *                    This parameter can be one of the following values:
   2717          *                       - TIM1_ICPolarity_Rising
   2718          *                       - TIM1_ICPolarity_Falling
   2719          *                  - TIM1_ICSelection: specifies the input to be used.
   2720          *                    This parameter can be one of the following values:
   2721          *                       - TIM1_ICSelection_DirectTI: TIM1 Input 3 is selected to
   2722          *                         be connected to IC3.
   2723          *                       - TIM1_ICSelection_IndirectTI: TIM1 Input 3 is selected to
   2724          *                         be connected to IC4.
   2725          *                       - TIM1_ICSelection_TRGI: TIM1 Input 3 is selected to be
   2726          *                         connected to TRGI.
   2727          *                  - TIM1_ICFilter: Specifies the Input Capture Filter.
   2728          *                    This parameter must be a value between 0x00 and 0x0F.
   2729          * Output         : None
   2730          * Return         : None
   2731          *******************************************************************************/
   2732          static void TI3_Config(u16 TIM1_ICPolarity, u16 TIM1_ICSelection,
   2733                                 u8 TIM1_ICFilter)
   2734          {
   2735            u32 tmpccmr2 = 0;
   2736          
   2737            tmpccmr2 = TIM1->CCMR.Data[1];
   2738          
   2739            /* Disable the Channel 3: Reset the CCE Bit */
   2740            *(vu32 *) CCER_CC3E_BB = CCER_CCE_Reset;
   2741          
   2742            /* Select the Input and set the filter */
   2743            tmpccmr2 &= CCMR_CC13S_Mask & CCMR_IC13F_Mask;
   2744            tmpccmr2 |= (u16)TIM1_ICSelection | (u16)((u16)TIM1_ICFilter << 4);
   2745          
   2746            TIM1->CCMR.Data[1] = (u16)tmpccmr2;
   2747          
   2748            /* Select the Polarity */
   2749            *(vu32 *) CCER_CC3P_BB = TIM1_ICPolarity;
   2750          
   2751            /* Set the CCE Bit */
   2752            *(vu32 *) CCER_CC3E_BB = CCER_CCE_Set;
   2753          }
   2754          
   2755          /*******************************************************************************
   2756          * Function Name  : TI4_Config
   2757          * Description    : Configure the TI4 as Input.
   2758          * Input          : - TIM1_ICPolarity : The Input Polarity.
   2759          *                    This parameter can be one of the following values:
   2760          *                       - TIM1_ICPolarity_Rising
   2761          *                       - TIM1_ICPolarity_Falling
   2762          *                  - TIM1_ICSelection: specifies the input to be used.
   2763          *                    This parameter can be one of the following values:
   2764          *                       - TIM1_ICSelection_DirectTI: TIM1 Input 4 is selected to
   2765          *                         be connected to IC4.
   2766          *                       - TIM1_ICSelection_IndirectTI: TIM1 Input 4 is selected to
   2767          *                         be connected to IC3.
   2768          *                       - TIM1_ICSelection_TRGI: TIM1 Input 4 is selected to be
   2769          *                         connected to TRGI.
   2770          *                  - TIM1_ICFilter: Specifies the Input Capture Filter.
   2771          *                    This parameter must be a value between 0x00 and 0x0F.
   2772          * Output         : None
   2773          * Return         : None
   2774          *******************************************************************************/
   2775          static void TI4_Config(u16 TIM1_ICPolarity, u16 TIM1_ICSelection,
   2776                                 u8 TIM1_ICFilter)
   2777          {
   2778              u32 tmpccmr2 = 0;
   2779            
   2780              tmpccmr2 = TIM1->CCMR.Data[1];
   2781              
   2782              /* Disable the Channel 4: Reset the CCE Bit */
   2783              *(vu32 *) CCER_CC4E_BB = CCER_CCE_Reset;
   2784            
   2785              /* Select the Input and set the filter */
   2786              tmpccmr2 &= CCMR_CC24S_Mask & CCMR_IC24F_Mask;
   2787              tmpccmr2 |= (u16)((u16)TIM1_ICSelection << 8) | (u16)((u16)TIM1_ICFilter << 12);
   2788            
   2789              TIM1->CCMR.Data[1] = (u16)tmpccmr2;
   2790            
   2791              /* Select the Polarity */
   2792              *(vu32 *) CCER_CC4P_BB = TIM1_ICPolarity;
   2793            
   2794              /* Set the CCE Bit */
   2795              *(vu32 *) CCER_CC4E_BB = CCER_CCE_Set;
   2796          }
   2797          /******************* (C) COPYRIGHT 2007 STMicroelectronics *****END OF FILE****/

   Maximum stack usage in bytes:

     Function                     .cstack
     --------                     -------
     TIM1_ARRPreloadConfig             0
     TIM1_BDTRConfig                   0
     TIM1_BDTRStructInit               0
     TIM1_CCPreloadControl             0
     TIM1_CCxCmd                       0
     TIM1_CCxNCmd                      0
     TIM1_ClearFlag                    0
     TIM1_ClearITPendingBit            0
     TIM1_ClearOC1Ref                  0
     TIM1_ClearOC2Ref                  0
     TIM1_ClearOC3Ref                  0
     TIM1_ClearOC4Ref                  0
     TIM1_Cmd                          0
     TIM1_CounterModeConfig            0
     TIM1_CtrlPWMOutputs               0
     TIM1_DMACmd                       0
     TIM1_DMAConfig                    0
     TIM1_ETRClockMode1Config          8
     TIM1_ETRClockMode2Config          8
     TIM1_ETRConfig                    8
     TIM1_EncoderInterfaceConfig      16
     TIM1_ForcedOC1Config              0
     TIM1_ForcedOC2Config              0
     TIM1_ForcedOC3Config              0
     TIM1_ForcedOC4Config              0
     TIM1_GenerateEvent                0
     TIM1_GetCapture1                  0
     TIM1_GetCapture2                  0
     TIM1_GetCapture3                  0
     TIM1_GetCapture4                  0
     TIM1_GetCounter                   0
     TIM1_GetFlagStatus                0
     TIM1_GetITStatus                  0
     TIM1_GetPrescaler                 0
     TIM1_ICInit                      24
     TIM1_ICStructInit                 0
     TIM1_ITConfig                     0
     TIM1_ITRxExternalClockConfig      8
     TIM1_Init                         0
     TIM1_InternalClockConfig          0
     TIM1_OC1FastConfig                0
     TIM1_OC1Init                      8
     TIM1_OC1NPolarityConfig           0
     TIM1_OC1PWMOutputs                0
     TIM1_OC1PolarityConfig            0
     TIM1_OC1PreloadConfig             0
     TIM1_OC2FastConfig                0
     TIM1_OC2Init                      8
     TIM1_OC2NPolarityConfig           0
     TIM1_OC2PolarityConfig            0
     TIM1_OC2PreloadConfig             0
     TIM1_OC3FastConfig                0
     TIM1_OC3Init                      8
     TIM1_OC3NPolarityConfig           0
     TIM1_OC3PolarityConfig            0
     TIM1_OC3PreloadConfig             0
     TIM1_OC4FastConfig                0
     TIM1_OC4Init                      8
     TIM1_OC4PWMOutputs                0
     TIM1_OC4PolarityConfig            0
     TIM1_OC4PreloadConfig             0
     TIM1_OCStructInit                 0
     TIM1_PWMIConfig                  32
     TIM1_PrescalerConfig              0
     TIM1_SelectCCDMA                  0
     TIM1_SelectCOM                    0
     TIM1_SelectHallSensor             0
     TIM1_SelectInputTrigger           0
     TIM1_SelectMasterSlaveMode        0
     TIM1_SelectOCxM                   0
     TIM1_SelectOnePulseMode           0
     TIM1_SelectOutputTrigger          0
     TIM1_SelectSlaveMode              0
     TIM1_SetAutoreload                0
     TIM1_SetClockDivision             0
     TIM1_SetCompare1                  0
     TIM1_SetCompare2                  0
     TIM1_SetCompare3                  0
     TIM1_SetCompare4                  0
     TIM1_SetCounter                   0
     TIM1_SetIC1Prescaler              0
     TIM1_SetIC2Prescaler              0
     TIM1_SetIC3Prescaler              0
     TIM1_SetIC4Prescaler              0
     TIM1_TIxExternalClockConfig      16
     TIM1_TimeBaseInit                 8
     TIM1_TimeBaseStructInit           0
     TIM1_UpdateDisableConfig          0
     TIM1_UpdateRequestConfig          0


   Section sizes:

     Function/Label               Bytes
     --------------               -----
     TIM1_Init                      52
     TIM1_OC1Init                   80
     ?Subroutine4                   12
     TIM1_OC1PWMOutputs             14
     ??Subroutine12_0                6
     TIM1_OC4PWMOutputs             16
     TIM1_OC4Init                   72
     TIM1_TimeBaseInit              42
     TIM1_OC2Init                   44
     ?Subroutine1                   24
     TIM1_OC3Init                   52
     TIM1_BDTRConfig                36
     TIM1_ICInit                   162
     TIM1_PWMIConfig               196
     TIM1_OCStructInit              20
     TIM1_ICStructInit              18
     TIM1_TimeBaseStructInit        18
     TIM1_BDTRStructInit            18
     TIM1_Cmd                        8
     ??Subroutine10_0                6
     TIM1_CtrlPWMOutputs             8
     TIM1_ITConfig                  20
     TIM1_DMAConfig                  4
     ?Subroutine6                   12
     TIM1_DMACmd                    22
     TIM1_InternalClockConfig       14
     TIM1_ETRClockMode1Config       60
     ?Subroutine7                    6
     TIM1_ETRClockMode2Config       40
     TIM1_ETRConfig                 24
     TIM1_ITRxExternalClockConfig   18
     TIM1_TIxExternalClockConfig    82
     TIM1_SelectInputTrigger        10
     ??Subroutine11_0                4
     TIM1_UpdateDisableConfig        8
     TIM1_UpdateRequestConfig       12
     TIM1_SelectHallSensor           8
     TIM1_SelectOnePulseMode        12
     TIM1_SelectOutputTrigger       10
     TIM1_SelectSlaveMode           10
     TIM1_SelectMasterSlaveMode     12
     TIM1_EncoderInterfaceConfig    42
     TIM1_PrescalerConfig           16
     TIM1_CounterModeConfig         10
     TIM1_ForcedOC1Config            4
     ?Subroutine2                    8
     ??Subroutine9_0                 8
     TIM1_ForcedOC2Config           10
     TIM1_ForcedOC3Config            4
     TIM1_ForcedOC4Config           20
     TIM1_ARRPreloadConfig           8
     TIM1_SelectCOM                  8
     TIM1_SelectCCDMA                8
     TIM1_CCPreloadControl           8
     TIM1_OC1PreloadConfig          12
     TIM1_OC2PreloadConfig          12
     TIM1_OC3PreloadConfig          12
     TIM1_OC4PreloadConfig          12
     TIM1_OC1FastConfig             12
     TIM1_OC2FastConfig             12
     TIM1_OC3FastConfig             12
     TIM1_OC4FastConfig             12
     TIM1_ClearOC1Ref               12
     TIM1_ClearOC2Ref               12
     TIM1_ClearOC3Ref               12
     TIM1_ClearOC4Ref               12
     TIM1_GenerateEvent             12
     TIM1_OC1PolarityConfig          6
     TIM1_OC1NPolarityConfig        12
     TIM1_OC2PolarityConfig         12
     TIM1_OC2NPolarityConfig        12
     TIM1_OC3PolarityConfig         12
     TIM1_OC3NPolarityConfig        12
     TIM1_OC4PolarityConfig         12
     TIM1_CCxCmd                    30
     TIM1_CCxNCmd                   28
     TIM1_SelectOCxM                86
     TIM1_SetCounter                 6
     TIM1_SetAutoreload             12
     TIM1_SetCompare1                6
     TIM1_SetCompare2                6
     TIM1_SetCompare3                6
     TIM1_SetCompare4                6
     TIM1_SetIC1Prescaler           10
     ?Subroutine0                    8
     TIM1_SetIC2Prescaler            4
     TIM1_SetIC3Prescaler           10
     TIM1_SetIC4Prescaler            4
     TIM1_SetClockDivision           8
     TIM1_GetCapture1                4
     ?Subroutine8                    6
     TIM1_GetCapture2                4
     TIM1_GetCapture3                4
     TIM1_GetCapture4                4
     TIM1_GetCounter                 4
     TIM1_GetPrescaler               4
     TIM1_GetFlagStatus              8
     ?Subroutine5                   10
     TIM1_ClearFlag                  0
     ?Subroutine3                   12
     TIM1_GetITStatus               20
     TIM1_ClearITPendingBit          2
     ??DataTable3                    4
     ??DataTable22                   4
     ??DataTable24                   4
     ??DataTable32                   4
     ??DataTable34                   4
     ??DataTable42                   4
     ??DataTable44                   4
     ??DataTable45                   4
     ??DataTable46                   4
     ??DataTable47                   4
     ??DataTable48                   4
     ??DataTable49                   4
     ??DataTable50                   4
     ??DataTable51                   4
     ??DataTable53                   4
     ??DataTable54                   4

 
 2 056 bytes in section .text
 
 2 056 bytes of CODE memory

Errors: none
Warnings: none
